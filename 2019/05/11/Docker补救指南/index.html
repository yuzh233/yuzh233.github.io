<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>Docker 补救指南 - harry&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="配置阿里云镜像加速阿里云主页搜索 容器镜像服务，进入「镜像仓库管理控制台」，根据说明文档操作即可。 学会使用帮助命令查看版本： 1docker version 查看docker安装信息： 1docker info 查看命令说明： 1docker --help">
<meta name="keywords" content="docker,微服务">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker 补救指南">
<meta property="og:url" content="http://yoursite.com/2019/05/11/Docker补救指南/index.html">
<meta property="og:site_name" content="harry&#39;s blog">
<meta property="og:description" content="配置阿里云镜像加速阿里云主页搜索 容器镜像服务，进入「镜像仓库管理控制台」，根据说明文档操作即可。 学会使用帮助命令查看版本： 1docker version 查看docker安装信息： 1docker info 查看命令说明： 1docker --help">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://img.yuzh.xyz/docker-note/wallhaven-263173.jpg">
<meta property="og:updated_time" content="2019-05-11T15:13:55.361Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker 补救指南">
<meta name="twitter:description" content="配置阿里云镜像加速阿里云主页搜索 容器镜像服务，进入「镜像仓库管理控制台」，根据说明文档操作即可。 学会使用帮助命令查看版本： 1docker version 查看docker安装信息： 1docker info 查看命令说明： 1docker --help">
<meta name="twitter:image" content="http://img.yuzh.xyz/docker-note/wallhaven-263173.jpg">







<link rel="icon" href="/images/star.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/vs.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/star.png" alt="Docker 补救指南" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">Home</a>
                
                <a class="navbar-item" href="/archives">Archives</a>
                
                <a class="navbar-item" href="/categories">Categories</a>
                
                <a class="navbar-item" href="/tags">Tags</a>
                
                <a class="navbar-item" href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/yuzh233">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-image">
        <span class="image is-7by1">
            <img class="thumbnail" src="http://img.yuzh.xyz/docker-note/wallhaven-263173.jpg" alt="Docker 补救指南">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-05-10T16:00:00.000Z">2019-05-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/docker/">docker</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    an hour read (About 11922 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Docker 补救指南
            
        </h1>
        <div class="content">
            <h1 id="配置阿里云镜像加速"><a href="#配置阿里云镜像加速" class="headerlink" title="配置阿里云镜像加速"></a>配置阿里云镜像加速</h1><p>阿里云主页搜索 <a href="https://help.aliyun.com/product/60716.html?spm=a2c4g.11186623.6.540.10823864peBl6O" target="_blank" rel="noopener">容器镜像服务</a>，进入<a href="https://cr.console.aliyun.com/cn-shanghai/instances/mirrors" target="_blank" rel="noopener">「镜像仓库管理控制台」</a>，根据说明文档操作即可。</p>
<h1 id="学会使用帮助命令"><a href="#学会使用帮助命令" class="headerlink" title="学会使用帮助命令"></a>学会使用帮助命令</h1><p>查看版本：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>
<p>查看docker安装信息：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure>
<p>查看命令说明：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker --<span class="hljs-built_in">help</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>使用方式：<code>docker COMMAND --help</code> 如：<code>docker logs --help</code></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Usage:	docker logs [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">Fetch the logs of a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --details        Show extra details provided to logs</span><br><span class="line">  -f, --follow         Follow <span class="hljs-built_in">log</span> output</span><br><span class="line">      --since string   Show logs since timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m <span class="hljs-keyword">for</span></span><br><span class="line">                       42 minutes)</span><br><span class="line">      --tail string    Number of lines to show from the end of the logs (default <span class="hljs-string">"all"</span>)</span><br><span class="line">  -t, --timestamps     Show timestamps</span><br><span class="line">      --until string   Show logs before a timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m</span><br><span class="line">                       <span class="hljs-keyword">for</span> 42 minutes)</span><br></pre></td></tr></table></figure>
<h1 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h1><h2 id="查看本地镜像"><a href="#查看本地镜像" class="headerlink" title="查看本地镜像"></a>查看本地镜像</h2><p><strong>docker images / docker image ls</strong></p>
<p>参数：</p>
<ul>
<li><p>-a 列出本地所有的镜像（包含所有中间层镜像）</p>
</li>
<li><p>-q 只显示镜像ID</p>
</li>
<li><p>–digests 显示镜像的摘要信息（会多一个GUGEST展示字段，相当于一个镜像的备注信息，有些镜像没有。）</p>
</li>
<li><p>–no-trunc 显示完整的镜像信息</p>
</li>
</ul>
<h2 id="从-Docker-Hub-查询镜像"><a href="#从-Docker-Hub-查询镜像" class="headerlink" title="从 Docker Hub 查询镜像"></a>从 Docker Hub 查询镜像</h2><p><strong>docker search 镜像名</strong></p>
<p>如：<code>docker search tomcat</code></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">NAME                                       DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">tomcat                                     Apache Tomcat is an open <span class="hljs-built_in">source</span> implementati…   2345                [OK]</span><br><span class="line">tomee                                      Apache TomEE is an all-Apache Java EE certif…   64                  [OK]</span><br><span class="line">dordoka/tomcat                             Ubuntu 14.04, Oracle JDK 8 and Tomcat 8 base…   53                                      [OK]</span><br><span class="line">davidcaste/alpine-tomcat                   Apache Tomcat 7/8 using Oracle Java 7/8 with…   34                                      [OK]</span><br><span class="line">bitnami/tomcat                             Bitnami Tomcat Docker Image                     28                                      [OK]</span><br><span class="line">cloudesire/tomcat                          Tomcat server, 6/7/8                            14                                      [OK]</span><br><span class="line">meirwa/spring-boot-tomcat-mysql-app        a sample spring-boot app using tomcat and My…   12                                      [OK]</span><br><span class="line">tutum/tomcat                               Base docker image to run a Tomcat applicatio…   11</span><br><span class="line">aallam/tomcat-mysql                        Debian, Oracle JDK, Tomcat &amp; MySQL              11                                      [OK]</span><br><span class="line">jeanblanchard/tomcat                       Minimal Docker image with Apache Tomcat         8</span><br><span class="line">arm32v7/tomcat                             Apache Tomcat is an open <span class="hljs-built_in">source</span> implementati…   6</span><br><span class="line">rightctrl/tomcat                           CentOS , Oracle Java, tomcat application ssl…   4                                       [OK]</span><br><span class="line">maluuba/tomcat7-java8                      Tomcat7 with java8.                             3</span><br><span class="line">amd64/tomcat                               Apache Tomcat is an open <span class="hljs-built_in">source</span> implementati…   2</span><br><span class="line">arm64v8/tomcat                             Apache Tomcat is an open <span class="hljs-built_in">source</span> implementati…   2</span><br><span class="line">fabric8/tomcat-8                           Fabric8 Tomcat 8 Image                          2                                       [OK]</span><br><span class="line">camptocamp/tomcat-logback                  Docker image <span class="hljs-keyword">for</span> tomcat with logback integra…   1                                       [OK]</span><br><span class="line">99taxis/tomcat7                            Tomcat7                                         1                                       [OK]</span><br><span class="line">s390x/tomcat                               Apache Tomcat is an open <span class="hljs-built_in">source</span> implementati…   0</span><br><span class="line">picoded/tomcat7                            tomcat7 with jre8 and MANAGER_USER / MANAGER…   0                                       [OK]</span><br><span class="line">oobsri/tomcat8                             Testing CI Jobs with different names.           0</span><br><span class="line">cfje/tomcat-resource                       Tomcat Concourse Resource                       0</span><br><span class="line">1and1internet/debian-9-java-8-tomcat-8.5   Our tomcat 8.5 image                            0                                       [OK]</span><br><span class="line">jelastic/tomcat                            An image of the Tomcat Java application serv…   0</span><br><span class="line">swisstopo/service-print-tomcat             backend tomcat <span class="hljs-keyword">for</span> service-print the <span class="hljs-literal">true</span>, …   0</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<ul>
<li><p>-s [数字]： 列出 star 不小于指定数值的镜像</p>
  <figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 查询星星数不小于 30 个的 tomcat 镜像</span></span><br><span class="line">docker search -s 30 tomcat</span><br><span class="line"><span class="hljs-comment"># -s 参数已废弃，可用 --filter 替代</span></span><br><span class="line">docker search --filter=stars=30 tomcat</span><br></pre></td></tr></table></figure>
</li>
<li><p>–no-trunc： 显示完整的镜像描述信息</p>
</li>
<li><p>–automated：只列出 automated build 类型的镜像</p>
</li>
</ul>
<h2 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h2><p><strong>docker pull 镜像名:版本号</strong></p>
<p>不加版本号默认 <code>:latest</code></p>
<h2 id="删除本地镜像"><a href="#删除本地镜像" class="headerlink" title="删除本地镜像"></a>删除本地镜像</h2><p><strong>docker rmi 镜像名字或ID</strong></p>
<p>参数：<code>-f</code> 删除中间层镜像</p>
<ul>
<li><p>删除单个</p>
  <figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 镜像ID</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除多个</p>
  <figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 镜像1:TAG 镜像2:TAG</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除全部</p>
<pre><code><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 命令的组合使用，将 $(docker image ls -qa) 的结果作为 前一个命令的参数。 `docker image ls -qa` 的结果就是一串镜像ID数组</span></span><br><span class="line">   docker rmi -f $(docker image ls -qa)</span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
<p><strong>有容器正在使用此镜像，不能删除怎么办？</strong></p>
<p>docker rmi -f XXX</p>
<h1 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h1><p><em>以 CentOS 容器为例</em></p>
<h2 id="新建并启动容器"><a href="#新建并启动容器" class="headerlink" title="新建并启动容器"></a>新建并启动容器</h2><p><strong>docker run [options] image [command] [ags…]</strong></p>
<p>options:</p>
<ul>
<li>–name=”容器名”：为容器指定一个名称</li>
<li>-d：后台运行容器，并返回容器ID，也即：<strong>启动守护式容器</strong></li>
<li><strong>-i</strong>：以交互式模式运行容器，通常与 <code>-t</code> 同时使用</li>
<li><strong>-t</strong>：为容器重新分配一个伪输入终端，通常与 <code>-i</code> 同时使用</li>
<li>-P：随机端口分配</li>
<li>-p：指定端口映射，有一下四种格式：<ul>
<li>ip:hostPort:containerPort</li>
<li>ip::containerPort</li>
<li>hostPort:containerPort</li>
<li>containerPort</li>
</ul>
</li>
</ul>
<p><strong>简单启动：</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it centos</span><br></pre></td></tr></table></figure>
<p><strong>带容器名启动：</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=<span class="hljs-string">"my-centos"</span> centos</span><br></pre></td></tr></table></figure>
<h2 id="查看当前所有正在运行的容器"><a href="#查看当前所有正在运行的容器" class="headerlink" title="查看当前所有正在运行的容器"></a>查看当前所有正在运行的容器</h2><p><strong>docker ps [options]</strong></p>
<p>options:</p>
<ul>
<li>-a：列出当前所有正在运行的容器 + 历史上运行过的</li>
<li>-l：显示最近创建的容器</li>
<li>-n：显示最近 n 个创建的容器</li>
<li>-q：静默模式，只显示容器编号（不加其他参数默认显示当前运行的所有容器的ID）</li>
<li>–no-trunc：不截断输出</li>
</ul>
<p>结合 <code>-a</code>/<code>-q</code> 参数，可以实现删除所有容器：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 删除最近的一个容器</span></span><br><span class="line">docker rm $(docker ps -lq)</span><br><span class="line"><span class="hljs-comment"># 强制删除最近的一个容器（若最近的一个容器正在运行）</span></span><br><span class="line">docker rm -f $(docker ps -lq)</span><br><span class="line"><span class="hljs-comment"># 删除历史所有的容器，包含正在运行的</span></span><br><span class="line">docker rm -f $(docker ps -aq)</span><br></pre></td></tr></table></figure>
<h2 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h2><p>一）exit：退出并停止</p>
<p>使用 <code>docker run -it --name=&quot;my-centos&quot; centos</code> 的方式启动容器会以一个交互式终端形式进入到容器内部，当执行 <code>exit</code> 时容器就自动停止了。</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">037deff7ded9        centos              <span class="hljs-string">"/bin/bash"</span>         14 seconds ago      **Exited (0) 5 seconds ago**                       my-centos</span><br></pre></td></tr></table></figure>
<p>二）Control + P + Q：退出不停止</p>
<p>重新运行容器，并在重启内执行快捷键之后：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES</span><br><span class="line">f654ef93ea3f        centos              <span class="hljs-string">"/bin/bash"</span>         About a minute ago   **Up About a minute**                       practical_sinoussi</span><br></pre></td></tr></table></figure>
<p><strong>当不停止退出了，如何重新进去呢？</strong> 查看下面的「进入正在运行的容器」章节</p>
<h2 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h2><p><strong>docker start 容器ID/容器名</strong></p>
<h2 id="重启容器"><a href="#重启容器" class="headerlink" title="重启容器"></a>重启容器</h2><p><strong>docker restart 容器ID/容器名</strong></p>
<h2 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h2><p><strong>docker stop 容器ID/容器名</strong></p>
<h2 id="强制停止容器"><a href="#强制停止容器" class="headerlink" title="强制停止容器"></a>强制停止容器</h2><p><strong>docker kill 容器ID/容器名</strong></p>
<h2 id="删除已停止的容器"><a href="#删除已停止的容器" class="headerlink" title="删除已停止的容器"></a>删除已停止的容器</h2><p><strong>docker rm 容器ID</strong></p>
<p>一次性删除多个容器？前面已经使用了一种方式：<code>docker rm -f $(docker ps -aq)</code></p>
<p>还有一种方式：<br><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 利用 linux 的管道符可变参数 xargs，将 | 前面的命令结果作为参数作为 | 后面命令的入参</span></span><br><span class="line">docker ps -aq | xargs docker rm -f</span><br></pre></td></tr></table></figure></p>
<h1 id="容器重要知识点"><a href="#容器重要知识点" class="headerlink" title="容器重要知识点"></a>容器重要知识点</h1><h2 id="启动守护式容器"><a href="#启动守护式容器" class="headerlink" title="启动守护式容器"></a>启动守护式容器</h2><p><strong>docker run -d 容器名/容器ID</strong></p>
<p>以守护式方式启动容器后查看容器进程：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker run -d centos</span></span><br><span class="line">4de40688015eaec0a015f5d408117d938459828e2379dec4268ae88a298a7704</span><br><span class="line"><span class="hljs-comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br></pre></td></tr></table></figure>
<p>发现并没有显示正在运行的容器进程，为啥？再看一下容器历史运行记录试试。。。</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">4de40688015e        centos              <span class="hljs-string">"/bin/bash"</span>         4 minutes ago       Exited (0) 4 minutes ago                       pedantic_benz</span><br></pre></td></tr></table></figure>
<p>发现刚刚以 <strong>守护式方式</strong> 启动的容器，启动之后就立马停止了！</p>
<blockquote>
<p>Docker 容器后台运行，就必须要有一个前台进程。\<br>什么意思呢？如果容器运行的命令不是那些 <strong>一直挂起</strong> 的命令（如：top、tail），容器是会自动退出的。\<br>这是由于 <strong>docker的机制问题</strong>，例如使用 nginx，启动 nginx 服务的命令是：<code>service nginx start</code>，这是一个后台命令，在 linux 中会一直在后台运行着。但是在 docker 中，nginx容器为后台模式运行模式，导致 docker 的 nginx 容器前台没有运行的应用。所以容器启动后会立即自动停止，因为这个容器觉得自己没有事情可做！😅\<br>最佳解决方案是：将要运行的程序以前台的方式运行！</p>
</blockquote>
<p>那么怎么让容器以<strong>守护式容器启动</strong>，但是避免前台没事可做导致容器自动关闭呢？简单的方式有：<strong>让后台运行的容器前台一直打印日志</strong>，这样就避免了前台没事可做导致容器退出😂。</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker run -d centos /bin/bash -c "while true; do echo hello harry!; sleep 1; done"</span></span><br><span class="line">2b8e4a0014ab7cb435ecc19f171daf027c1291fa24b77ae52132ba9c225962d8</span><br><span class="line"><span class="hljs-comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">2b8e4a0014ab        centos              <span class="hljs-string">"/bin/bash -c 'while…"</span>   3 seconds ago       Up 3 seconds                            angry_aryabhata</span><br></pre></td></tr></table></figure>
<p>可以看到此时容器正在以后台运行，但是没有关闭。解释一下 <code>/bin/bash</code>，</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果 -c 选项存在，命令就从字符串中读取。如果字符串后有参数，他们将会被分配到参数的位置上，从<span class="hljs-variable">$0</span>开始。</span><br></pre></td></tr></table></figure>
<h2 id="查看容器日志"><a href="#查看容器日志" class="headerlink" title="查看容器日志"></a>查看容器日志</h2><p><strong>docker logs -f -t –tail 容器ID</strong></p>
<p>optins：</p>
<ul>
<li>-t：加入时间戳</li>
<li>-f：跟随最新日志打印</li>
<li>–tail 数字：显示最后多少条</li>
</ul>
<p>查看刚刚以守护容器运行的进程：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">04b01b87b990        centos              <span class="hljs-string">"/bin/bash -c 'while…"</span>   5 seconds ago       Up 4 seconds                            modest_chaplygin</span><br><span class="line"><span class="hljs-comment"># docker logs -t -f --tail 10 04b01b87b990 从倒数第 10 条日志开始查看，不停的追加，并且显示日志打印的时间。</span></span><br><span class="line">2019-04-14T10:56:11.635841663Z hello harry!</span><br><span class="line">2019-04-14T10:56:12.638348360Z hello harry!</span><br><span class="line">2019-04-14T10:56:13.645537151Z hello harry!</span><br><span class="line">2019-04-14T10:56:14.651628446Z hello harry!</span><br><span class="line">2019-04-14T10:56:15.654658791Z hello harry!</span><br><span class="line">2019-04-14T10:56:16.658972279Z hello harry!</span><br><span class="line">2019-04-14T10:56:17.664596508Z hello harry!</span><br><span class="line">2019-04-14T10:56:18.668527236Z hello harry!</span><br><span class="line">2019-04-14T10:56:19.671418530Z hello harry!</span><br><span class="line">2019-04-14T10:56:20.676871204Z hello harry!</span><br><span class="line">2019-04-14T10:56:21.682418501Z hello harry!</span><br><span class="line">2019-04-14T10:56:22.683835449Z hello harry!</span><br><span class="line">2019-04-14T10:56:23.688968112Z hello harry!</span><br></pre></td></tr></table></figure>
<h2 id="查看容器内运行的进程"><a href="#查看容器内运行的进程" class="headerlink" title="查看容器内运行的进程"></a>查看容器内运行的进程</h2><p><strong>docker top 容器ID</strong></p>
<p>查看刚刚守护式运行的容器的内部进程：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker top 04b01b87b990</span></span><br><span class="line">PID                 USER                TIME                COMMAND</span><br><span class="line">8568                root                0:00                /bin/bash -c <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> hello harry!; sleep 1; <span class="hljs-keyword">done</span></span><br><span class="line">8921                root                0:00                sleep 1</span><br></pre></td></tr></table></figure>
<h2 id="查看容器内部细节"><a href="#查看容器内部细节" class="headerlink" title="查看容器内部细节"></a>查看容器内部细节</h2><p><strong>docker inspect 容器ID</strong></p>
<h2 id="进入正在运行的容器并以命令行交互"><a href="#进入正在运行的容器并以命令行交互" class="headerlink" title="进入正在运行的容器并以命令行交互"></a>进入正在运行的容器并以命令行交互</h2><p>前面学到过 <strong>不关闭容器并退出</strong> 的快捷键是：<code>contrl + p + q</code>，那么退出之后怎么重新进入呢？有以下两种方式。</p>
<h3 id="docker-attach-容器ID"><a href="#docker-attach-容器ID" class="headerlink" title="docker attach 容器ID"></a>docker attach 容器ID</h3><p>「演示」</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker rm -f $(docker ps -aq) 先把所有容器杀死</span></span><br><span class="line"><span class="hljs-comment"># docker run -it --name='my-centos' centos 以交互式终端启动容器</span></span><br><span class="line">[root@b7324d8b56b9 /]<span class="hljs-comment"># pwd</span></span><br><span class="line">/</span><br><span class="line">[root@b7324d8b56b9 /]<span class="hljs-comment"># ll</span></span><br><span class="line">total 56</span><br><span class="line">-rw-r--r--   1 root root 12082 Mar  5 17:36 anaconda-post.log</span><br><span class="line">lrwxrwxrwx   1 root root     7 Mar  5 17:34 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root   360 Apr 14 11:24 dev</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr 14 11:24 etc</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 home</span><br><span class="line">lrwxrwxrwx   1 root root     7 Mar  5 17:34 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root     9 Mar  5 17:34 lib64 -&gt; usr/lib64</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 media</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 使用快捷键 control + p + q 不关闭容器并退出</span></span><br><span class="line">[root@b7324d8b56b9 /]<span class="hljs-comment"># %</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES</span><br><span class="line">b7324d8b56b9        centos              <span class="hljs-string">"/bin/bash"</span>         About a minute ago   Up About a minute                       my-centos</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 可以看到容器依然在运行，执行命令 docker attach b7324d8b56b9 重新进入。</span></span><br><span class="line">[root@b7324d8b56b9 /]<span class="hljs-comment"># pwd</span></span><br><span class="line">/</span><br><span class="line">[root@b7324d8b56b9 /]<span class="hljs-comment"># ls</span></span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></table></figure>
<h3 id="docker-exec-it-容器ID-bashShell"><a href="#docker-exec-it-容器ID-bashShell" class="headerlink" title="docker exec -it 容器ID bashShell"></a>docker exec -it 容器ID bashShell</h3><p>「演示」</p>
<p>进入容器内部执行命令：<br><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 先不关闭退出容器 control + p + q</span></span><br><span class="line"><span class="hljs-comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b7324d8b56b9        centos              <span class="hljs-string">"/bin/bash"</span>         7 minutes ago       Up 7 minutes                            my-centos</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># docker exec -it b7324d8b56b9 /bin/bash 一样进入了容器</span></span><br><span class="line">[root@60711933f7dd /]<span class="hljs-comment"># pwd</span></span><br><span class="line">/</span><br><span class="line">[root@60711933f7dd /]<span class="hljs-comment"># ls</span></span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 执行 exit 命令退出容器，PS：这里容器会关闭吗？</span></span><br><span class="line">[root@60711933f7dd /]<span class="hljs-comment"># exit</span></span><br><span class="line"><span class="hljs-built_in">exit</span></span><br><span class="line"><span class="hljs-comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">60711933f7dd        centos              <span class="hljs-string">"/bin/bash"</span>         2 minutes ago       Up 2 minutes                            my-centos</span><br><span class="line"><span class="hljs-comment"># 可以看到，以 exec 方式进入的容器执行 exit 并不会关闭容器。</span></span><br></pre></td></tr></table></figure></p>
<p>不进入容器，在宿主机执行容器内部命令：<br><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker exec -it 60711933f7dd ls -l /usr</span></span><br><span class="line">total 68</span><br><span class="line">dr-xr-xr-x  2 root root 16384 Mar  5 17:36 bin</span><br><span class="line">drwxr-xr-x  2 root root  4096 Apr 11  2018 etc</span><br><span class="line">drwxr-xr-x  2 root root  4096 Apr 11  2018 games</span><br><span class="line">drwxr-xr-x  3 root root  4096 Mar  5 17:35 include</span><br><span class="line">dr-xr-xr-x 19 root root  4096 Mar  5 17:36 lib</span><br><span class="line">dr-xr-xr-x 24 root root 16384 Mar  5 17:36 lib64</span><br><span class="line">drwxr-xr-x 11 root root  4096 Mar  5 17:36 libexec</span><br><span class="line">drwxr-xr-x 12 root root  4096 Mar  5 17:34 <span class="hljs-built_in">local</span></span><br><span class="line">dr-xr-xr-x  2 root root  4096 Mar  5 17:36 sbin</span><br><span class="line">drwxr-xr-x 52 root root  4096 Mar  5 17:36 share</span><br><span class="line">drwxr-xr-x  4 root root  4096 Mar  5 17:34 src</span><br><span class="line">lrwxrwxrwx  1 root root    10 Mar  5 17:34 tmp -&gt; ../var/tmp</span><br><span class="line">harry@192  ~/Learning/docker-note</span><br><span class="line"><span class="hljs-comment"># 这里以 linux 中的 `ls -l /usr` 命令代替上面的 `/bin/bash` 命令查看了容器 centos 中的 /usr 下的所有文件，并且将返回的结果直接展示到了宿主机上（即：本机MacOS）</span></span><br></pre></td></tr></table></figure></p>
<p>两者的区别：</p>
<ul>
<li>attach：直接进入容器启动命令的终端，不会启动新的进程。</li>
<li>exec：是在容器中打开新的终端，并且可以启动新的进程。</li>
</ul>
<h2 id="从容器内拷贝文件到主机上"><a href="#从容器内拷贝文件到主机上" class="headerlink" title="从容器内拷贝文件到主机上"></a>从容器内拷贝文件到主机上</h2><p><strong>docker cp 容器ID:容器内路径 宿主机路径</strong></p>
<p>容器关闭其运行过程中产生的数据文件都会丢失，所以需要把容器中的数据文件拷贝到宿主机上。</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker attach 60711933f7dd 进入容器</span></span><br><span class="line">[root@60711933f7dd /]<span class="hljs-comment"># ll</span></span><br><span class="line">total 56</span><br><span class="line">-rw-r--r--   1 root root 12082 Mar  5 17:36 anaconda-post.log</span><br><span class="line"><span class="hljs-comment"># 看到有一个日志文件，将其复制到宿主机，先宿主机当前文件：</span></span><br><span class="line">harry@192  ~/Learning/docker-note  ll</span><br><span class="line">total 40</span><br><span class="line">-rw-r--r--@ 1 harry  staff    17K  4 14 19:56 Docker笔记.md</span><br><span class="line"><span class="hljs-comment"># 可以看到当前宿主句只有一个文件。将容器中的 anaconda-post.log 复制到当前文件夹 ~/Learning/docker-note</span></span><br><span class="line"><span class="hljs-comment"># control + p + q 需要先退出容器</span></span><br><span class="line"><span class="hljs-comment"># docker cp 60711933f7dd:/anaconda-post.log ./ 复制到当前目录下</span></span><br><span class="line"><span class="hljs-comment"># ll 查看当前宿主机文件</span></span><br><span class="line">total 64</span><br><span class="line">-rw-r--r--@ 1 harry  staff    17K  4 14 20:01 Docker笔记.md</span><br><span class="line">-rw-r--r--  1 harry  staff    12K  3  6 01:36 anaconda-post.log</span><br></pre></td></tr></table></figure>
<h1 id="镜像原理"><a href="#镜像原理" class="headerlink" title="镜像原理"></a>镜像原理</h1><h2 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h2><blockquote>
<p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件。它包含运行某个软件所需的所有内容，包括代码、库、环境、环境变量和配置文件。</p>
</blockquote>
<h3 id="UnionFS（联合文件系统）"><a href="#UnionFS（联合文件系统）" class="headerlink" title="UnionFS（联合文件系统）"></a>UnionFS（联合文件系统）</h3><blockquote>
<p>unionFS 是一种分层、轻量级并且高性能的文件系统，它支持 <strong>对文件系统的修改作为一次提交来一层层的叠加</strong>，同时可以将不同目录挂载到同一虚拟文件系统下。\<br>联合文件系统是 Docker 镜像的基础。镜像可以通过分层来继承，基于基础镜像（没有父镜像），可以制作各种具体的镜像。</p>
</blockquote>
<p>特性：一次同时加载多个文件系统，但从外面看来，只能看到一个文件系统。联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<h3 id="Docker-镜像加载原理"><a href="#Docker-镜像加载原理" class="headerlink" title="Docker 镜像加载原理"></a>Docker 镜像加载原理</h3><h3 id="为什么-Docker-镜像要采用分层的结构"><a href="#为什么-Docker-镜像要采用分层的结构" class="headerlink" title="为什么 Docker 镜像要采用分层的结构"></a>为什么 Docker 镜像要采用分层的结构</h3><p>共享资源。如：有多个镜像都是从相同的 base 镜像构建而来，那么宿主机只需要在磁盘上保存一份 base 镜像。同时内存中也祝需要加载一份 base 镜像，就可以为所有的容器服务了。而且镜像的每一层都可以共享。</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>Docker 镜像都是只读的。当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称为「容器层」，容器层之下的都叫做「镜像层」。</p>
<h2 id="镜像的-commit-操作"><a href="#镜像的-commit-操作" class="headerlink" title="镜像的 commit 操作"></a>镜像的 commit 操作</h2><p><em>docker commit 提交容器副本使之成为一个新的镜像</em></p>
<p><strong>docker commit -m=”提交的描述信息” -a=”作者” 容器ID 要创建的镜像名[:标签名]</strong></p>
<p>「演示」</p>
<p><strong>1. 从 DockerHub 上下载 tomcat 镜像到本地并成功运行</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker pull tomcat</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/tomcat</span><br><span class="line">e79bb959ec00: Pull complete</span><br><span class="line">d4b7902036fe: Pull complete</span><br><span class="line">1b2a72d4e030: Pull complete</span><br><span class="line">de423484a946: Pull complete</span><br><span class="line">ceaac3b844f7: Pull complete</span><br><span class="line">88f01b722a52: Pull complete</span><br><span class="line">c23be56a9ac1: Pull complete</span><br><span class="line">d852ffd6d31f: Pull complete</span><br><span class="line">11775a3d792d: Pull complete</span><br><span class="line">13fdd17462ac: Pull complete</span><br><span class="line">2092995a1e54: Pull complete</span><br><span class="line">Digest: sha256:409501d73062ab508930eab827fcb19d7d3f7e9bbe63bc6d587114c6af4bee12</span><br><span class="line">Status: Downloaded newer image <span class="hljs-keyword">for</span> tomcat:latest</span><br><span class="line"><span class="hljs-comment"># 以交互式终端并「映射容器端口到宿主机指定端口」运行 tomcat</span></span><br><span class="line"><span class="hljs-comment"># docker run -it -p 8888:8080 --name='my-tomcat' tomcat</span></span><br><span class="line"><span class="hljs-comment"># 日志太多不展示了，执行「退出不关闭容器 control + p + q」。</span></span><br><span class="line"><span class="hljs-comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS                    NAMES</span><br><span class="line">c492f4bbce3e        tomcat              <span class="hljs-string">"catalina.sh run"</span>   About a minute ago   Up About a minute   0.0.0.0:8888-&gt;8080/tcp   my-tomcat</span><br><span class="line"><span class="hljs-comment"># 可以看到容器中的 8080 端口已经映射到了宿主机上的 8888 端口，访问 http://localhost:8888 可以正常访问。</span></span><br></pre></td></tr></table></figure>
<p>PS：运行 tomcat 不以交互式终端 <code>-it</code> 也可以，因为其有前台进程运行（日志打印），所以容器不会退出。</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker rm -f $(docker ps -aq) 先删除原有容器</span></span><br><span class="line"><span class="hljs-comment"># docker run -d -p 8888:8080 --name='my-tomcat' tomcat</span></span><br><span class="line">96dad0f6272538e8a1c3359a42d0a6493814f1972c8adf86087dbd322d1033e6</span><br><span class="line"><span class="hljs-comment"># docker logs -f -t --tail 10 96dad0f62725 查看日志：逐条追加，显示日期，从倒数第 10 条开始。</span></span><br><span class="line">......</span><br><span class="line">org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/<span class="hljs-built_in">local</span>/tomcat/webapps/manager] has finished <span class="hljs-keyword">in</span> [18] ms</span><br><span class="line">2019-04-14T16:44:25.733314600Z 14-Apr-2019 16:44:25.732 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler [<span class="hljs-string">"http-nio-8080"</span>]</span><br><span class="line">2019-04-14T16:44:25.749280600Z 14-Apr-2019 16:44:25.748 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler [<span class="hljs-string">"ajp-nio-8009"</span>]</span><br><span class="line">2019-04-14T16:44:25.754519300Z 14-Apr-2019 16:44:25.754 INFO [main] org.apache.catalina.startup.Catalina.start Server startup <span class="hljs-keyword">in</span> 889 ms</span><br></pre></td></tr></table></figure>
<p>使用 <code>-P</code> 参数将会随机分配宿主机端口映射给容器。</p>
<p><strong>2. 故意删除上一步镜像生产 tomcat 容器的文档</strong></p>
<p>先访问 <a href="http://localhost:8888" target="_blank" rel="noopener">http://localhost:8888</a> 查看 document 页面：</p>
<p><img src="http://img.yuzh.xyz/docker-note/1555261778530.jpg" alt="tomcat主页"></p>
<p>点击 Documentation，可以正常看到页面:</p>
<p><img src="http://img.yuzh.xyz/docker-note/1555261916030.jpg" alt="document页面"></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 重新进入上面启动的 tomcat 容器</span></span><br><span class="line"><span class="hljs-comment"># docker exec -it 96dad0f62725 /bin/bash</span></span><br><span class="line">root@96dad0f62725:/usr/<span class="hljs-built_in">local</span>/tomcat<span class="hljs-comment"># pwd</span></span><br><span class="line">/usr/<span class="hljs-built_in">local</span>/tomcat</span><br><span class="line"><span class="hljs-comment"># 删除当前 tomcat 应用的 document 文档页面</span></span><br><span class="line">root@96dad0f62725:/usr/<span class="hljs-built_in">local</span>/tomcat<span class="hljs-comment"># rm -rf webapps/docs/</span></span><br><span class="line">root@96dad0f62725:/usr/<span class="hljs-built_in">local</span>/tomcat<span class="hljs-comment">#</span></span><br></pre></td></tr></table></figure>
<p>刷新文档页面再次查看：</p>
<p><img src="http://img.yuzh.xyz/docker-note/1555262087054.jpg" alt="文档页面已不存在"></p>
<p>PS：这只是修改了当前容器的 tomcat，并没有 commit 作为一个新容器。所以当当前容器被删除之后修改的内容也随着被删除了，如需要保存修改后的内容，可以 commit 这个容器作为一个新的镜像。</p>
<p><strong>3. 也即当前的 tomcat 运行实例是一个没有文档内容的容器。以它为模版 commit 一个没有 doc 的 tommcat 新镜像 my-tomcat</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker exec -it 1b498158b4ee7fc71d80d9da9ba30d890fa5cddcffb7d1edbffbbfe21b4d2317 /bin/bash</span></span><br><span class="line">root@1b498158b4ee:/usr/<span class="hljs-built_in">local</span>/tomcat<span class="hljs-comment"># pwd</span></span><br><span class="line">/usr/<span class="hljs-built_in">local</span>/tomcat</span><br><span class="line">root@1b498158b4ee:/usr/<span class="hljs-built_in">local</span>/tomcat<span class="hljs-comment"># rm -rf webapps/docs/</span></span><br><span class="line">root@1b498158b4ee:/usr/<span class="hljs-built_in">local</span>/tomcat<span class="hljs-comment"># exit</span></span><br><span class="line"><span class="hljs-built_in">exit</span> <span class="hljs-comment"># 这里只是退出新开的终端进程，实际上没有退出 tomcat 的进程。</span></span><br><span class="line"><span class="hljs-comment"># 执行 docker commit -m="del tomcat documentation" -a="harry" 1b498158b izhiliu/tomcat2:v2</span></span><br><span class="line"><span class="hljs-comment"># 镜像名规范：组织名/镜像名:TAG</span></span><br><span class="line">sha256:cf18ff34c415b8ca05494a3d6faa276a0b1229cffb5563cffbb8f0af533b6f47</span><br><span class="line"><span class="hljs-comment"># 可以看到执行成功之后返回了新的镜像的唯一标识，再查看一下镜像：docker image ls | grep tomcat</span></span><br><span class="line">izhiliu/tomcat2     v2                  cf18ff34c415        About a minute ago   465MB</span><br><span class="line">tomcat              latest              5a069ba3df4d        41 hours ago         465MB</span><br><span class="line"><span class="hljs-comment"># 刚刚新建的镜像已经存在了，启动一下看看：docker run -d -p 8080:8080 izhiliu/tomcat2:v2</span></span><br></pre></td></tr></table></figure>
<p>可以看到新的容器已经没有 documentation 页面了。</p>
<p><strong>4. 启动我们 commit 后的新景象并和原来的对比</strong></p>
<ul>
<li>官方的 tomcat:latest 有 Documentation 页面</li>
<li>自定义的 izhiliu/tomcat:v2 没有 Documentation 页面</li>
</ul>
<h1 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h1><blockquote>
<p>Docker 的理念</p>
<ul>
<li>将应用与运行的环境打包形成容器运行，运行可以伴随着容器，但是我们对数据的要求是持久化的。</li>
<li>容器之间希望有可能共享数据</li>
</ul>
</blockquote>
<p>Docker 容器运行时产生的数据，如果不通过 <code>docker commit</code> 生成新的镜像，使得数据作为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了。</p>
<p>之前学到过一个命令「从容器拷贝数据到宿主机」：<code>docker cp 容器ID:容器路径 宿主机路径</code></p>
<p>但是这只能实现将数据手动保存，并不能实现容器之间的数据共享。解决这种需求，可以使用 <strong>docker 的数据卷</strong></p>
<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>一）容器持久化</p>
<p>二）容器间继承 + 数据共享</p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><blockquote>
<p>卷就是目录或文件，存在于一个或多个容器中，由 Docker 挂载到容器，但不属于联合文件系统，因此可以能够绕过 UnionFS 提供的一些用于持久存储或共享数据的特性。\<br>卷设计的目的就是数据的持久化，完全独立于容器的生命周期，因此 Docker 不会在删除容器时删除其挂载的数据卷。</p>
</blockquote>
<p>特点：</p>
<ol>
<li>数据卷可在容器之间共享或重用数据</li>
<li>卷中的更改可以直接生效</li>
<li>数据卷中的更改不会包含在镜像的更新中</li>
<li>数据卷的生命周期一直持续大没有容器使用它为止</li>
</ol>
<h2 id="使用一：命令方式挂载数据卷"><a href="#使用一：命令方式挂载数据卷" class="headerlink" title="使用一：命令方式挂载数据卷"></a>使用一：命令方式挂载数据卷</h2><p><strong>docker run -it -v /宿主机文件绝对路径:/容器内路径 镜像名</strong></p>
<p>「演示：查看数据卷挂载是否成功」</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 以数据卷挂载方式重新启动容器</span></span><br><span class="line"><span class="hljs-comment"># -----------------------------------------------------------------</span></span><br><span class="line"><span class="hljs-comment"># docker run -it -v ~/Learning/docker-note/host-data-volumes:/container-data-volumes centos</span></span><br><span class="line"><span class="hljs-comment"># PS：一定要使用绝对路径，宿主机目录和容器目录若不存在会自动创建</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 查看宿主机文件</span></span><br><span class="line"><span class="hljs-comment"># -----------------------------------------------------------------</span></span><br><span class="line"><span class="hljs-comment"># pwd</span></span><br><span class="line">/Users/harry/Learning/docker-note</span><br><span class="line"><span class="hljs-comment"># ll</span></span><br><span class="line">total 80</span><br><span class="line">-rw-r--r--@ 1 harry  staff    26K  4 15 21:12 README.md</span><br><span class="line">-rw-r--r--  1 harry  staff    12K  3  6 01:36 anaconda-post.log</span><br><span class="line">drwxr-xr-x  2 harry  staff    64B  4 15 21:11 host-data-volumes <span class="hljs-comment"># 被新创建的文件夹</span></span><br><span class="line">drwxr-xr-x  5 harry  staff   160B  4 15 01:14 img</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 查看容器文件</span></span><br><span class="line"><span class="hljs-comment"># -----------------------------------------------------------------</span></span><br><span class="line"><span class="hljs-comment"># pwd</span></span><br><span class="line">/</span><br><span class="line"><span class="hljs-comment"># ll</span></span><br><span class="line">total 56</span><br><span class="line">-rw-r--r--   1 root root 12082 Mar  5 17:36 anaconda-post.log</span><br><span class="line">lrwxrwxrwx   1 root root     7 Mar  5 17:34 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   2 root root    64 Apr 15 13:11 container-data-volumes <span class="hljs-comment"># 被创建的文件夹</span></span><br><span class="line">drwxr-xr-x   5 root root   360 Apr 15 13:11 dev</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr 15 13:11 etc</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<figure class="highlight gradle hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用 「docker <span class="hljs-keyword">inspect</span> 容器ID」 查看容器是否挂载成功</span><br></pre></td></tr></table></figure>
<p><img src="http://img.yuzh.xyz/docker-note/1555334292716.jpg" alt="可以看到，数据卷已经成功绑定了。"></p>
<p>「演示：容器与宿主机之间共享数据」</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 查看宿主机数据卷绑定文件路径下的所有文件</span></span><br><span class="line"><span class="hljs-comment"># pwd</span></span><br><span class="line">/Users/harry/Learning/docker-note/host-data-volumes</span><br><span class="line"><span class="hljs-comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># -----------------------------------------------------</span></span><br><span class="line"><span class="hljs-comment"># 查看容器中数据卷绑定文件路径下的所有文件</span></span><br><span class="line"><span class="hljs-comment"># pwd</span></span><br><span class="line">/container-data-volumes</span><br><span class="line"><span class="hljs-comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># -----------------------------------------------------</span></span><br><span class="line"><span class="hljs-comment"># 分别在宿主机和容器数据卷绑定的目录中创建不同的文件，观察文件是否同步过去了</span></span><br><span class="line"><span class="hljs-comment"># 在宿主机创建文件 touch host.txt &amp;&amp; ll</span></span><br><span class="line">-rw-r--r--  1 harry  staff     0B  4 15 21:25 host.txt</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 在容器中创建文件 touch contianer.txt &amp;&amp; ll</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 15 13:26 contianer.txt <span class="hljs-comment"># 容器创建的</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 15 13:25 host.txt <span class="hljs-comment"># 前面宿主机创建的</span></span><br><span class="line"><span class="hljs-comment"># 可以看到，文件创建成功了并且刚刚在宿主机创建的文件已经同步到了容器中。</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 再观察宿主机有没有同步容器的文件过来 ll</span></span><br><span class="line">-rw-r--r--  1 harry  staff     0B  4 15 21:26 contianer.txt</span><br><span class="line">-rw-r--r--  1 harry  staff     0B  4 15 21:25 host.txt</span><br></pre></td></tr></table></figure>
<p>「演示：容器停止后，主机修改后的数据是否会同步到容器中」</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 停止容器 / 或者删除容器重新建立数据卷（宿主机的目录不变）</span></span><br><span class="line"><span class="hljs-comment"># exit</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 宿主机修改文件： echo 'host update' &gt;&gt; host.txt &amp;&amp; cat host.txt</span></span><br><span class="line">host update</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 启动容器，查看文件内容</span></span><br><span class="line"><span class="hljs-comment"># docker start 30a574c0dbe1</span></span><br><span class="line"><span class="hljs-comment"># docker attach 30a574c0dbe1</span></span><br><span class="line"><span class="hljs-comment"># cd container-data-volumes/ &amp;&amp; cat host.txt</span></span><br><span class="line">host update</span><br><span class="line"><span class="hljs-comment"># 可以看到内容修改成功同步过来，重新创建的容器文件也是一样的会被同步过来。</span></span><br></pre></td></tr></table></figure>
<p>「演示：使用带权限的挂载命令」</p>
<p><strong>docker run -it -v /宿主机文件绝对路径:/容器内路径:ro 镜像名</strong></p>
<ul>
<li><code>:ro</code> read only</li>
</ul>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 删除刚刚创建的容器</span></span><br><span class="line"><span class="hljs-comment"># docker rm -f $(docker ps -aq)</span></span><br><span class="line"><span class="hljs-comment"># 带权限的挂载数据卷</span></span><br><span class="line"><span class="hljs-comment"># docker run -it -v ~/Learning/docker-note/host-data-volumes/:/container-data-volumes:ro centos</span></span><br><span class="line"><span class="hljs-comment"># 依旧查看宿主机文件是否同步到位</span></span><br><span class="line"><span class="hljs-comment"># cd container-data-volumes/ &amp;&amp; ll</span></span><br><span class="line">-rw-r--r-- 1 root root  0 Apr 15 13:26 contianer.txt</span><br><span class="line">-rw-r--r-- 1 root root 12 Apr 15 13:32 host.txt</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 重点来了，容器修改共享文件夹（数据卷）的数据</span></span><br><span class="line"><span class="hljs-comment"># touch modify.txt</span></span><br><span class="line">touch: cannot touch <span class="hljs-string">'modify.txt'</span>: Read-only file system</span><br></pre></td></tr></table></figure>
<p><code>:vo</code> 限制了容器对数据卷的写权限，使得容器只能够读数据。查看 <code>docker inspect 75b1409b8a9e</code>:</p>
<p><img src="http://img.yuzh.xyz/docker-note/1555336040258.jpg" alt></p>
<h2 id="使用二：-DockerFile-挂载数据卷"><a href="#使用二：-DockerFile-挂载数据卷" class="headerlink" title="使用二： DockerFile 挂载数据卷"></a>使用二： DockerFile 挂载数据卷</h2><p>DockerFile 的概念先不讨论，重点在于怎么使用 DockerFile 实现宿主机与容器之间的目录挂载。</p>
<p>「步骤」</p>
<p><strong>1）创建 DockerFile 所属目录</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir dockerfile-volumes &amp;&amp; ll</span><br><span class="line">total 88</span><br><span class="line">-rw-r--r--@ 1 harry  staff    29K  4 17 23:46 README.md</span><br><span class="line">-rw-r--r--  1 harry  staff    12K  3  6 01:36 anaconda-post.log</span><br><span class="line">drwxr-xr-x  2 harry  staff    64B  4 17 23:48 dockerfile-volumes <span class="hljs-comment"># 存放 DockerFile 的文件夹</span></span><br><span class="line">drwxr-xr-x  4 harry  staff   128B  4 17 23:22 host-data-volumes</span><br><span class="line">drwxr-xr-x  7 harry  staff   224B  4 15 21:47 img</span><br></pre></td></tr></table></figure>
<p><strong>2） 编写 Dockerfile 文件，在 DockerFile 中通过 <code>VOLUME</code> 指令给镜像添加「一个或多个」数据卷。</strong></p>
<figure class="highlight avrasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-symbol">PS:</span> 以命令方式只能挂载一个数据卷</span><br></pre></td></tr></table></figure>
<p>cd dockerfile-volumes &amp;&amp; touch Dockerfile</p>
<p>添加以下内容<br><figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># Volume Dockerfile 方式挂载数据卷测试</span></span><br><span class="line">FROM centos</span><br><span class="line"><span class="hljs-comment"># 挂载命令</span></span><br><span class="line">VOLUME [<span class="hljs-string">"/data-volumes-container1"</span>,<span class="hljs-string">"/data-volumes-container2"</span>]</span><br><span class="line">CMD <span class="hljs-built_in">echo</span> <span class="hljs-string">"image is building..."</span></span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure></p>
<p>PS：VOLUME命令指定了分别在容器上挂载两个目录：<code>/data-volumes-container1</code> / <code>/data-volumes-container2</code>，但是没有指定宿主机目录。这是因为一个镜像会被不同的宿主机运行，但是宿主机路径不是每个执行镜像的宿主机都是相同的。<strong>通过 DockerFile 挂载的数据卷宿主机目录会被默认分配。</strong></p>
<p><strong>3）执行构建命令 docker build -f /Dockerfile名（路径） -t 镜像名:TAG .</strong></p>
<ul>
<li><code>-f</code>：指定 Dockerfile 名（路径），如果就在当前目录执行可以不加。</li>
<li><code>-t</code>：指定镜像名</li>
</ul>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker build -f ~/Learning/docker-note/dockerfile-volumes/Dockerfile -t yuzh/centos:v1 .</span></span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"> ---&gt; 9f38484d220f</span><br><span class="line">Step 2/4 : VOLUME [<span class="hljs-string">'/data-volumes-container1'</span>,<span class="hljs-string">'data-volumes-container2'</span>] <span class="hljs-comment"># 挂载命令</span></span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 0ad66b7ad4f9</span><br><span class="line">Removing intermediate container 0ad66b7ad4f9</span><br><span class="line"> ---&gt; 1fad13e698d5</span><br><span class="line">Step 3/4 : CMD <span class="hljs-built_in">echo</span> <span class="hljs-string">"image is building..."</span></span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 2a90e6187e24</span><br><span class="line">Removing intermediate container 2a90e6187e24</span><br><span class="line"> ---&gt; fc3713190c97</span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 2a361cb58947</span><br><span class="line">Removing intermediate container 2a361cb58947</span><br><span class="line"> ---&gt; 31f766043abf</span><br><span class="line">Successfully built 31f766043abf</span><br><span class="line">Successfully tagged yuzh/centos:v1</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># docker image ls</span></span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">yuzh/centos          v1                  31f766043abf        33 seconds ago      202MB</span><br><span class="line">izhiliu/tomcat2      v2                  cf18ff34c415        2 days ago          465MB</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># docker run -it yuzh/centos:v1 运行构建的镜像查看数据卷是否存在</span></span><br><span class="line"><span class="hljs-comment"># ll</span></span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 17 16:24 data-volumes-container1</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 17 16:24 data-volumes-container2</span><br></pre></td></tr></table></figure>
<p><strong>4）<code>docker inspect 容器ID</code> 查看宿主机位置，验证数据共享</strong></p>
<p><img src="http://img.yuzh.xyz/docker-note/WX20190418-003627@2x.png" alt></p>
<h2 id="使用三：使用数据卷容器实现数据共享"><a href="#使用三：使用数据卷容器实现数据共享" class="headerlink" title="使用三：使用数据卷容器实现数据共享"></a>使用三：使用数据卷容器实现数据共享</h2><p>实现容器间数据共享的第三种方式，使用命令：</p>
<p><strong>docker run -it –volumes-from 父容器ID 镜像ID</strong></p>
<p>「演示」</p>
<p>沿用之前通过 Dockerfile 创建的镜像</p>
<p><strong>一）继承与被继承容器之间的数据共享：</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 启动第一个容器，作为父容器</span></span><br><span class="line"><span class="hljs-comment"># docker run -it --name container01 yuzh/centos:v1</span></span><br><span class="line"><span class="hljs-comment"># ll 自然而然的可以看到有两个数据卷文件</span></span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 18 16:19 data-volumes-container1</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 18 16:19 data-volumes-container2</span><br><span class="line"><span class="hljs-comment"># 进去 data-volumes-container1，创建一个文件</span></span><br><span class="line"><span class="hljs-comment"># touch container01.txt &amp;&amp; ll</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:21 container01.txt</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 不停止退出，创建第二个容器，继承第一个容器作为数据卷容器</span></span><br><span class="line"><span class="hljs-comment"># docker run -it --name container02 --volumes-from container01 yuzh/centos:v1</span></span><br><span class="line"><span class="hljs-comment"># cd data-volumes-container1 &amp;&amp; ll</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:21 container01.txt</span><br><span class="line"><span class="hljs-comment"># 可以看到容器1创建的文件同步过来了，在容器2创建一个文件，观察容器1是否同步：</span></span><br><span class="line"><span class="hljs-comment"># touch container01.txt</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># docker attach container01</span></span><br><span class="line"><span class="hljs-comment"># cd data-volumes-container1 &amp;&amp; ll</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container01.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container02.txt</span><br></pre></td></tr></table></figure>
<p><strong>二）相同父容器的不同子容器之间的数据共享</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 创建第三个容器，继承容器1，操作容器3，观察容器1、2是否都有数据</span></span><br><span class="line"><span class="hljs-comment"># docker run -it --name container03 --volumes-from container01 yuzh/centos:v1</span></span><br><span class="line"><span class="hljs-comment"># cd data-volumes-container1 &amp;&amp; ll</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container01.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container02.txt</span><br><span class="line"><span class="hljs-comment"># 自然的看到了容器1、2之间共享的数据，在容器3创建文件：</span></span><br><span class="line"><span class="hljs-comment"># touch container03.txt</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 容器1肯定是有此文件的，因为容器3是挂载在容器1之上的。</span></span><br><span class="line"><span class="hljs-comment"># docker attach container01</span></span><br><span class="line"><span class="hljs-comment"># cd data-volumes-container1 &amp;&amp; ll</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container01.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container02.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:34 container03.txt</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 问题来了：容器2会有 container03.txt 吗？</span></span><br><span class="line"><span class="hljs-comment"># docker attach container02</span></span><br><span class="line"><span class="hljs-comment"># cd data-volumes-container1 &amp;&amp; ll</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container01.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container02.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:34 container03.txt</span><br><span class="line"><span class="hljs-comment"># 也是有的</span></span><br></pre></td></tr></table></figure>
<p><strong>三）删除父容器，两个子容器之间的数据还会共享吗？</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker ps</span></span><br><span class="line">0bce4751cdf2        yuzh/centos:v1      <span class="hljs-string">"/bin/sh -c /bin/bash"</span>   7 minutes ago       Up 7 minutes                            container03</span><br><span class="line">98d3db76ca2c        yuzh/centos:v1      <span class="hljs-string">"/bin/sh -c /bin/bash"</span>   16 minutes ago      Up 16 minutes                           container02</span><br><span class="line">fb12544f689b        yuzh/centos:v1      <span class="hljs-string">"/bin/sh -c /bin/bash"</span>   21 minutes ago      Up 21 minutes                           container0</span><br><span class="line"><span class="hljs-comment"># docker rm -f 0bce4751cdf2</span></span><br><span class="line">0bce4751cdf2</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 进入容器2，修改文件。</span></span><br><span class="line"><span class="hljs-comment"># docker attach container02</span></span><br><span class="line"><span class="hljs-comment"># touch container02-update.txt &amp;&amp; ll</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container01.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:42 container02-update.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container02.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:34 container03.txt</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># ok，进入容器3，观察是否有 container02-update.txt</span></span><br><span class="line"><span class="hljs-comment"># [control + p + q]</span></span><br><span class="line"><span class="hljs-comment"># docker exec -it fb12544f689b /bin/bash</span></span><br><span class="line"><span class="hljs-comment"># cd data-volumes-container1 &amp;&amp; ll</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container01.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:42 container02-update.txt <span class="hljs-comment"># 容器2创建的</span></span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:27 container02.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 18 16:34 container03.txt</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 嗯，有点东西～</span></span><br><span class="line"><span class="hljs-comment"># 容器3修改文件进去容器2查看，也是一样的会被同步，不重复了。。。</span></span><br></pre></td></tr></table></figure>
<p><strong>结论：容器之间配置信息的传递，数据卷的生命周期一直持续到没有容器使用它为止。</strong></p>
<h1 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h1><blockquote>
<p>DockerFile 是用来构建 Docker 镜像的构建文件，是由一系列参数和命令构成的脚本。</p>
</blockquote>
<p><strong>DockerFile 规则</strong></p>
<ul>
<li>每条保留字指令都必须为大写字母且后面要至少包含一个参数</li>
<li>指令按照从上往下，顺序执行。</li>
<li>每条指令都会创建一个新的镜像层，并对镜像进行提交。</li>
</ul>
<p><strong>DockerFile 执行流程</strong></p>
<ol>
<li>docker 从基础镜像运行一个容器</li>
<li>执行一条指令并对容器作出修改</li>
<li>执行类似于 docker commit 的操作提交一个新镜像层</li>
<li>docker 再基于刚提交的镜像运行一个新容器</li>
<li>执行 dockerfile 中的下一条指令直到所有指令都执行完成</li>
</ol>
<blockquote>
<p>从应用软件的角度来看，DockerFile、Docker 镜像、Docker 容器分别代表软件的三个不同阶段</p>
<ul>
<li>DockerFile 是软件的原材料 </li>
<li>Docker 镜像时软件的交付品 </li>
<li>Docker 容器则可以认为是软件的运行态 </li>
</ul>
<p>DockerFile 面向开发，Docker 镜像成为交付标准，Docker 容器设计部署与运维。三者缺一不可，合力充当 Docker 体系的基石。</p>
</blockquote>
<h2 id="DockerFile-指令"><a href="#DockerFile-指令" class="headerlink" title="DockerFile 指令"></a>DockerFile 指令</h2><p><strong>FROM</strong></p>
<p>基础镜像，当前新镜像是基于哪个镜像的。</p>
<p><strong>MAINTAINER</strong></p>
<p>镜像维护者的姓名和邮箱地址</p>
<p><strong>RUN</strong></p>
<p>容器构建时需要执行的命令</p>
<p><strong>EXPOSE</strong></p>
<p>当前容器对外暴露的端口号</p>
<p><strong>WORKDIR</strong></p>
<p>指定在容器创建后，终端登陆进来后默认的工作目录，一个落脚点。</p>
<p><strong>ENV</strong></p>
<p>在构建时设置环境变量</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ENV</span> MY_PATH /usr/mytest</span><br><span class="line">这个环境变量可以在后续的任何 <span class="hljs-keyword">RUN</span><span class="hljs-bash"> 指令中使用，如同在命令前面指定了环境变量前缀一样。</span></span><br><span class="line"></span><br><span class="line">也可以在其他指令中直接使用这些环境变量，如：</span><br><span class="line"><span class="hljs-keyword">WORKDIR</span><span class="hljs-bash"> <span class="hljs-variable">$&#123;MY_PATH&#125;</span></span></span><br></pre></td></tr></table></figure>
<p><strong>ADD</strong></p>
<p>将宿主机下的文件拷贝进镜像且 ADD 命令会自动处理 URL 和解压 tar 压缩包</p>
<p><strong>COPY</strong></p>
<p>类似于 ADD，拷贝文件和目录到镜像中。</p>
<p>将从「构建上下文」目录中的文件/目录，复制到新的一层镜像的目录中</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPY <span class="hljs-built_in">source</span> target       <span class="hljs-comment"># shell 格式</span></span><br><span class="line">COPY [<span class="hljs-string">'source'</span>,<span class="hljs-string">'target'</span>] <span class="hljs-comment"># exec 格式</span></span><br></pre></td></tr></table></figure>
<p><strong>VOLUME</strong></p>
<p>容器数据卷，用于数据保存和持久化。</p>
<p><strong>CMD</strong></p>
<p>指定一个容器「启动」时要运行的命令</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD &lt;命令&gt;                            <span class="hljs-comment"># shell</span></span><br><span class="line">CMD [<span class="hljs-string">'可执行文件'</span>,<span class="hljs-string">'参数1'</span>,<span class="hljs-string">'参数2'</span>...]   <span class="hljs-comment"># exec</span></span><br></pre></td></tr></table></figure>
<p>DockerFile 中可以有多个 CMD 命令，但只有最后一个生效。CMD 会被 <code>docker run</code> 之后的参数替换。</p>
<p><strong>ENTERPOINT</strong></p>
<p>指定一个容器启动时要运行的命令，ENTRYPOINT 的目的和 CMD 一样，都是指定容器启动命令和参数。</p>
<p>ENTRYPOINT 与 CMD 的区别在于：<strong>若存在多个 CMD 指令，docker build 时只会以最后一条 CMD 为准，而 ENTRYPOINT 则是追加。</strong></p>
<p><strong>ONBUILD</strong></p>
<p>如果当前镜像是一个父镜像，并且 DockerFile 中存在 ONBUILD 指令，那么子镜像 build 后会「触发」父镜像的 ONBUILD 指令，相当于父镜像执行一些子镜像构建之后的收尾操作。</p>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="Base镜像（scratch）"><a href="#Base镜像（scratch）" class="headerlink" title="Base镜像（scratch）"></a>Base镜像（scratch）</h3><p>Docker Hub 中 99% 的镜像都是通过在 base 镜像中安装和配置需要的软件构建出来的。</p>
<h3 id="自定义镜像-my-centos"><a href="#自定义镜像-my-centos" class="headerlink" title="自定义镜像 my-centos"></a>自定义镜像 my-centos</h3><p>目的：练习基础指令</p>
<p>需求：进入 centos 镜像中，会发现：</p>
<ul>
<li>工作目录是 <code>/</code> 根目录</li>
<li>不支持 <code>vim</code> 命令</li>
<li>不支持 <code>ifconfig</code> 命令</li>
</ul>
<p>这是因为 centos 镜像是一个最基础的镜像，共用本机系统内核，去除了不是必须的一些软件及命令或功能。我们的需求是自己构建一个 centos 镜像，使其默认进入我们指定的工作目录，并支持以上两个命令。</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># pwd</span></span><br><span class="line">/Users/harry/Learning/docker-note/docker-file</span><br><span class="line"><span class="hljs-comment"># touch DockerFile &amp;&amp; ll</span></span><br><span class="line">-rw-r--r--  1 harry  staff     0B  4 24 00:33 DockerFile</span><br></pre></td></tr></table></figure>
<p><strong>「编写 DockerFile」</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># vim DockerFile</span></span><br><span class="line">FROM centos  <span class="hljs-comment"># 指定基础镜像</span></span><br><span class="line">MAINTAINER harry&lt;yuzh233@gmail.com&gt; <span class="hljs-comment"># 设置镜像构建者信息</span></span><br><span class="line"></span><br><span class="line">ENV MY_PATH /usr/<span class="hljs-built_in">local</span> <span class="hljs-comment"># 设置一个环境变量</span></span><br><span class="line">WORKDIR <span class="hljs-variable">$MY_PATH</span> <span class="hljs-comment"># 指定工作目录，使用环境变量</span></span><br><span class="line"></span><br><span class="line">RUN yum -y install vim <span class="hljs-comment"># 执行命令：安装 vim</span></span><br><span class="line">RUN yum -y install net-tools <span class="hljs-comment"># 执行命令：安装 net-tools</span></span><br><span class="line"></span><br><span class="line">EXPOSE 8088 <span class="hljs-comment"># 暴露端口</span></span><br><span class="line"></span><br><span class="line">CMD <span class="hljs-built_in">echo</span> <span class="hljs-string">'my workdir is $MY_PATH'</span> <span class="hljs-comment"># 容器启动执行：打印字符串</span></span><br><span class="line">CMD /bin/bash <span class="hljs-comment"># 容器启动真正执行的命令</span></span><br></pre></td></tr></table></figure>
<p><strong>「执行构建」</strong></p>
<p><strong>docker build -f 路径 -t 镜像名:TAG .</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker build -f DockerFile -t izhiliu/centos:v1 .</span></span><br><span class="line"><span class="hljs-comment"># DockerFile 就在当前路径下，不用指定目录</span></span><br><span class="line"></span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line"><span class="hljs-comment"># 可以看到，有几行 DockerFile 就构建几层镜像。</span></span><br><span class="line">Step 1/9 : FROM centos</span><br><span class="line"> ---&gt; 9f38484d220f</span><br><span class="line">Step 2/9 : MAINTAINER harry&lt;yuzh233@gmail.com&gt;</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 4966da40f5e8</span><br><span class="line">Removing intermediate container 4966da40f5e8</span><br><span class="line"> ---&gt; 32eb4f4c77ba</span><br><span class="line">Step 3/9 : ENV MY_PATH /usr/<span class="hljs-built_in">local</span></span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 8b4d372d1404</span><br><span class="line">Removing intermediate container 8b4d372d1404</span><br><span class="line"> ---&gt; b412c79d5a02</span><br><span class="line">Step 4/9 : WORKDIR <span class="hljs-variable">$MY_PATH</span></span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 42d2d2df5804</span><br><span class="line">Removing intermediate container 42d2d2df5804</span><br><span class="line"> ---&gt; 082bb5098dbf</span><br><span class="line">Step 5/9 : RUN yum -y install vim</span><br><span class="line"><span class="hljs-comment"># ......开始安装 vim v......</span></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 3536627f1160</span><br><span class="line"> ---&gt; 58f9bbd23b2e</span><br><span class="line">Step 6/9 : RUN yum -y install net-tools</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 3a6d39924e48</span><br><span class="line"><span class="hljs-comment">#  ...... 开始安装 net-tools ......</span></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 3a6d39924e48</span><br><span class="line"> ---&gt; 2065a365b531</span><br><span class="line">Step 7/9 : EXPOSE 8088</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> b836df8bcfb6</span><br><span class="line">Removing intermediate container b836df8bcfb6</span><br><span class="line"> ---&gt; 190f68eeb2d8</span><br><span class="line">Step 8/9 : CMD <span class="hljs-built_in">echo</span> <span class="hljs-string">'my workdir is $MY_PATH'</span></span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> cadea312695e</span><br><span class="line">Removing intermediate container cadea312695e</span><br><span class="line"> ---&gt; 8d6c248e24c9</span><br><span class="line">Step 9/9 : CMD /bin/bash </span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> e5ff383a4407</span><br><span class="line">Removing intermediate container e5ff383a4407</span><br><span class="line"> ---&gt; a8a7bed31bd7</span><br><span class="line"><span class="hljs-comment"># 出现下面两行代表构建成功</span></span><br><span class="line">Successfully built a8a7bed31bd7</span><br><span class="line">Successfully tagged izhiliu/centos:v1</span><br></pre></td></tr></table></figure>
<p><strong>「验证新镜像」</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker images</span></span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">izhiliu/centos       v1                  87ebc03d1d90        32 seconds ago      425MB</span><br><span class="line"><span class="hljs-comment"># &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 镜像构建成功！</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># docker run -it 87ebc03d1d90</span></span><br><span class="line">[root@1bd54814f9c5 <span class="hljs-built_in">local</span>]<span class="hljs-comment"># pwd</span></span><br><span class="line">/usr/<span class="hljs-built_in">local</span></span><br><span class="line"><span class="hljs-comment"># &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 根目录指定成功！</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># touch file</span></span><br><span class="line"><span class="hljs-comment"># vim file -&gt; 有效</span></span><br><span class="line"><span class="hljs-comment"># &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; vim 安装成功！</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># ifconfig</span></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 12  bytes 968 (968.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"><span class="hljs-comment"># &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; net-tools 安装成功！</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># docker history izhiliu/centos:v1</span></span><br><span class="line"><span class="hljs-comment"># 执行这条命令可以看到某个镜像的构建过程，可以看到镜像从头到尾构建，显示根据构建时间倒序展示。</span></span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">87ebc03d1d90        14 minutes ago      /bin/sh -c <span class="hljs-comment">#(nop)  CMD ["/bin/sh" "-c" "/bin…   0B</span></span><br><span class="line">ddc2e1121ff8        14 minutes ago      /bin/sh -c <span class="hljs-comment">#(nop)  CMD ["/bin/sh" "-c" "echo…   0B</span></span><br><span class="line">a1010b933008        14 minutes ago      /bin/sh -c <span class="hljs-comment">#(nop)  EXPOSE 8088                  0B</span></span><br><span class="line">670892d19e9f        14 minutes ago      /bin/sh -c yum -y install net-tools             84.1MB</span><br><span class="line">fb03334297ef        14 minutes ago      /bin/sh -c yum -y install vim                   139MB</span><br><span class="line">daceee7c426b        15 minutes ago      /bin/sh -c <span class="hljs-comment">#(nop) WORKDIR /usr/local            0B</span></span><br><span class="line">f39af63b22d3        15 minutes ago      /bin/sh -c <span class="hljs-comment">#(nop)  ENV MY_PATH=/usr/local       0B</span></span><br><span class="line">ef7f5536cec3        15 minutes ago      /bin/sh -c <span class="hljs-comment">#(nop)  MAINTAINER harry&lt;yuzh233@…   0B</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># docker inspect izhiliu/centos:v1 查看容器信息</span></span><br><span class="line">......</span><br><span class="line"><span class="hljs-string">"Author"</span>: <span class="hljs-string">"harry&lt;yuzh233@gmail.com&gt;"</span>,</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h3 id="CMD-ENTERPOINT-镜像案例"><a href="#CMD-ENTERPOINT-镜像案例" class="headerlink" title="CMD/ENTERPOINT 镜像案例"></a>CMD/ENTERPOINT 镜像案例</h3><p><strong>一）DockerFile 中可以有不多个 <code>CMD</code> 指令，但只有最后一个生效。并且最后一个 CMD 指令会被 <code>docker run</code> 之后的参数替换（如果有）</strong></p>
<p>「演示」</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 查看 tomcat 官方 DockerFile，最后一行：</span></span><br><span class="line">CMD [<span class="hljs-string">"catalina.sh"</span>, <span class="hljs-string">"run"</span>] </span><br><span class="line"><span class="hljs-comment"># tomcat 容器就是通过这行命令启动起来的，我们试着在启动时指定其他命令：</span></span><br><span class="line">docker run -it --name cat -p 7070:8080 tomcat ls -l</span><br><span class="line"><span class="hljs-comment"># 我们用 ls -l 命令替换掉了 ["catalina.sh", "run"]</span></span><br><span class="line">total 152</span><br><span class="line">-rw-r--r-- 1 root root  19539 Apr 10 14:33 BUILDING.txt</span><br><span class="line">-rw-r--r-- 1 root root   6090 Apr 10 14:33 CONTRIBUTING.md</span><br><span class="line">-rw-r--r-- 1 root root  57092 Apr 10 14:33 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root   1726 Apr 10 14:33 NOTICE</span><br><span class="line">-rw-r--r-- 1 root root   3255 Apr 10 14:33 README.md</span><br><span class="line">-rw-r--r-- 1 root root   7139 Apr 10 14:33 RELEASE-NOTES</span><br><span class="line">-rw-r--r-- 1 root root  16262 Apr 10 14:33 RUNNING.txt</span><br><span class="line">drwxr-xr-x 2 root root   4096 Apr 13 00:10 bin</span><br><span class="line">drwxr-sr-x 2 root root   4096 Apr 10 14:33 conf</span><br><span class="line">drwxr-sr-x 2 root staff  4096 Apr 13 00:10 include</span><br><span class="line">drwxr-xr-x 2 root root   4096 Apr 13 00:09 lib</span><br><span class="line">drwxrwxrwx 2 root root   4096 Apr 10 14:31 logs</span><br><span class="line">drwxr-sr-x 3 root staff  4096 Apr 13 00:10 native-jni-lib</span><br><span class="line">drwxr-xr-x 2 root root   4096 Apr 13 00:09 temp</span><br><span class="line">drwxr-xr-x 7 root root   4096 Apr 10 14:31 webapps</span><br><span class="line">drwxrwxrwx 2 root root   4096 Apr 10 14:31 work</span><br><span class="line"><span class="hljs-comment"># 可以看到最后一行命令执行成功了，查看容器进程：docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS                          PORTS               NAMES</span><br><span class="line">202be91cd7ec        tomcat              <span class="hljs-string">"ls -l"</span>             About a minute ago   Exited (0) About a minute ago                       cat</span><br><span class="line"><span class="hljs-comment"># tomcat 没有启动起来，原因是我们用 ls -a 命令代替了启动 tomcat 的命令</span></span><br></pre></td></tr></table></figure>
<p><strong>二）docker run 之后的参数会被当作参数传递给 ENTRYPOINT，形成新的命令组合。</strong></p>
<p>定制一个查看当前 ip 信息的容器，DockerFile如下：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 安装 curl 工具，发起请求到查ip的网站查询返回信息</span></span><br><span class="line"><span class="hljs-comment"># curl 命令可以用来执行下载、发送各种 HTTP 请求，指定 HTTP 头部等操作。</span></span><br><span class="line">FROM centos</span><br><span class="line">RUN yum install -y curl <span class="hljs-comment"># 执行安装</span></span><br><span class="line">CMD [<span class="hljs-string">"curl"</span>,<span class="hljs-string">"-s"</span>,<span class="hljs-string">"http://ip.cn"</span>]</span><br><span class="line"><span class="hljs-comment"># 执行构建</span></span><br><span class="line">docker build -f DockerFile2 -t show-ip .</span><br></pre></td></tr></table></figure>
<p>启动容器，会看到 <a href="http://ip.cn" target="_blank" rel="noopener">http://ip.cn</a> 的相应信息展示到了控制台，<code>curl -s xxx</code> 命令执行成功。但是当我们需要在容器启动时变更启动中的参数时，CMD就不起作用了。</p>
<p>如我们希望在容器运行时给 <code>curl -s http://ip.cn</code> 加一个 <code>-i</code> 参数用来显示完整的相应头信息，此时会报错说找不到命令，原因是将 -i 当作一个命令去替换掉了 curl -s <a href="http://ip.cn" target="_blank" rel="noopener">http://ip.cn</a> 命令，这显然不是我们想看到的。</p>
<p>这种情况可以使用 ENTRYPOINT，只需在 DockerFile 中替换 CMD 指令为 ENTRYPOINT 即可。<code>ENTRYPOINT [&quot;curl&quot;,&quot;-s&quot;,&quot;xxxx&quot;]</code>，此时我们在容器启动时指定的参数会以参数的形式追加到 curl -s <a href="http://ip.cn" target="_blank" rel="noopener">http://ip.cn</a> 后面而不是替换原来命令了。</p>
<h3 id="自定义镜像-Tomcat"><a href="#自定义镜像-Tomcat" class="headerlink" title="自定义镜像 Tomcat"></a>自定义镜像 Tomcat</h3><p>自定义一个 tomcat 的镜像，使其启动就是运行了一个 tomcat，实际上就是以 centos 为基础镜像安装了 jdk 和 tomcat 的环境，并设置为启动而已。</p>
<p>「步骤」</p>
<ol>
<li>创建 DockerFile 所在目录，准备镜像所需要的 jdk 和 tomcat 安装包。</li>
</ol>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------------------</span><br><span class="line">~/Learning/docker-note/docker-file/my-tomcat(master*) » <span class="hljs-built_in">pwd</span> &amp;&amp; ll                                         harry@192</span><br><span class="line">/Users/harry/Learning/docker-note/docker-file/my-tomcat</span><br><span class="line">total 375368</span><br><span class="line">-rw-r--r--  1 harry  staff     0B  5  2 21:35 Dockerfile</span><br><span class="line">-rwxr-xr-x@ 1 harry  staff   8.5M  6  5  2018 apache-tomcat-7.0.75.tar.gz</span><br><span class="line">-rwxr-xr-x@ 1 harry  staff   175M  6  5  2018 jdk-8u121-linux-x64.tar.gz</span><br><span class="line">------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>编写 DockerFile</li>
</ol>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">~/Learning/docker-note/docker-file(master*) » <span class="hljs-built_in">cd</span> my-tomcat                                                harry@192</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER harry&lt;yuzh233@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">ADD apache-tomcat-7.0.75.tar.gz /usr/<span class="hljs-built_in">local</span></span><br><span class="line">ADD jdk-8u121-linux-x64.tar.gz /usr/<span class="hljs-built_in">local</span></span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">ENV WORK_PATH /usr/<span class="hljs-built_in">local</span></span><br><span class="line">WORKDIR <span class="hljs-variable">$WORK_PATH</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 设置 java 环境目录，此文件夹名可以在本地将 jdk-8u121-linux-x64.tar.gz 得到</span></span><br><span class="line">ENV JAVA_HOME /usr/<span class="hljs-built_in">local</span>/jdk1.8.0_121</span><br><span class="line">ENV CLASSPATH <span class="hljs-variable">$JAVA_HOME</span>/lib/dt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"></span><br><span class="line">ENV CATALINA_HOME /usr/<span class="hljs-built_in">local</span>/apache-tomcat-7.0.75</span><br><span class="line">ENV CATALINA_BASE /usr/<span class="hljs-built_in">local</span>/apache-tomcat-7.0.75</span><br><span class="line"></span><br><span class="line">ENV PATH <span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$CATALINA_HOME</span>/lib:<span class="hljs-variable">$CATALINA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># ENTRYPOINT ["/usr/local/apache-tomcat-7.0.75/bin/startup.sh"]</span></span><br><span class="line"><span class="hljs-comment"># CMD ["/usr/local/apache-tomcat-7.0.75/bin/startup.sh","run"]</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># tail 命令：查看文件最后指定行，-f 参数不停的读取。</span></span><br><span class="line">CMD /usr/<span class="hljs-built_in">local</span>/apache-tomcat-7.0.75/bin/startup.sh \</span><br><span class="line">    &amp;&amp; tail -f /usr/<span class="hljs-built_in">local</span>/c/logs/catalina.out</span><br></pre></td></tr></table></figure>
<p>PS：容器启动命令加上 <code>tail</code> 是使其输出日志以免以 -d 后台运行时由于前台进程无事可做自动停止容器。</p>
<ol start="3">
<li>构建镜像</li>
</ol>
<p><strong>docker build -f Dockerfile -t yuzh/lovely-cat .</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">Sending build context to Docker daemon  192.2MB</span><br><span class="line">Step 1/14 : FROM centos</span><br><span class="line"> ---&gt; 9f38484d220f</span><br><span class="line">Step 2/14 : MAINTAINER harry&lt;yuzh233@gmail.com&gt;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; ef7f5536cec3</span><br><span class="line">Step 3/14 : ADD apache-tomcat-7.0.75.tar.gz /usr/<span class="hljs-built_in">local</span></span><br><span class="line"> ---&gt; ce38ea3cc5bf</span><br><span class="line">Step 4/14 : ADD jdk-8u121-linux-x64.tar.gz /usr/<span class="hljs-built_in">local</span></span><br><span class="line"> ---&gt; 9bb44d59445f</span><br><span class="line">Step 5/14 : RUN yum -y install vim</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 4e44d91a2a47</span><br><span class="line"><span class="hljs-comment"># ......</span></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 4e44d91a2a47</span><br><span class="line"> ---&gt; 5dfdd1d562ee</span><br><span class="line">Step 6/14 : ENV WORK_PATH /usr/<span class="hljs-built_in">local</span></span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 11087250850a</span><br><span class="line">Removing intermediate container 11087250850a</span><br><span class="line"> ---&gt; 81440053e1c9</span><br><span class="line">Step 7/14 : WORKDIR <span class="hljs-variable">$WORK_PATH</span></span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> dbc004146319</span><br><span class="line">Removing intermediate container dbc004146319</span><br><span class="line"> ---&gt; 240cc0a13f09</span><br><span class="line">Step 8/14 : ENV JAVA_HOME /usr/<span class="hljs-built_in">local</span>/jdk1.8.0_121</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 9c1f3a418a1f</span><br><span class="line">Removing intermediate container 9c1f3a418a1f</span><br><span class="line"> ---&gt; 1a27a3df60ab</span><br><span class="line">Step 9/14 : ENV CLASSPATH <span class="hljs-variable">$JAVA_HOME</span>/lib/dt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 0f8cc5d9ea9c</span><br><span class="line">Removing intermediate container 0f8cc5d9ea9c</span><br><span class="line"> ---&gt; 35126d06a7ca</span><br><span class="line">Step 10/14 : ENV CATALINA_HOME /usr/<span class="hljs-built_in">local</span>/apache-tomcat-7.0.75</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 0e015a7542f0</span><br><span class="line">Removing intermediate container 0e015a7542f0</span><br><span class="line"> ---&gt; 22af3e7209e9</span><br><span class="line">Step 11/14 : ENV CATALINA_BASE /usr/<span class="hljs-built_in">local</span>/apache-tomcat-7.0.75</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 0dc6317ab454</span><br><span class="line">Removing intermediate container 0dc6317ab454</span><br><span class="line"> ---&gt; cfd95a85a2d3</span><br><span class="line">Step 12/14 : ENV PATH <span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$CATALINA_HOME</span>/lib:<span class="hljs-variable">$CATALINA_HOME</span>/bin</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> b1b9a6a3e859</span><br><span class="line">Removing intermediate container b1b9a6a3e859</span><br><span class="line"> ---&gt; f03c22aef15d</span><br><span class="line">Step 13/14 : EXPOSE 8080</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 61a077e13bde</span><br><span class="line">Removing intermediate container 61a077e13bde</span><br><span class="line"> ---&gt; afc175ba3243</span><br><span class="line">Step 14/14 : ENTRYPOINT [<span class="hljs-string">"/usr/local/apache-tomcat-7.0.75/bin/startup.sh"</span>]</span><br><span class="line"> ---&gt; Running <span class="hljs-keyword">in</span> 753701ca8f2b</span><br><span class="line">Removing intermediate container 753701ca8f2b</span><br><span class="line"> ---&gt; 9a7ad3e1deb1</span><br><span class="line">Successfully built 9a7ad3e1deb1</span><br><span class="line">Successfully tagged yuzh/lovely-cat:latest</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">4. 运行新建的容器</span><br><span class="line"></span><br><span class="line">```sh</span><br><span class="line">~/Learning/docker-note/docker-file/my-tomcat(master*) » docker image ls                                                                harry@192</span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">yuzh/lovely-cat      latest              4d2b3d59f957        2 minutes ago       731MB</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">~/Learning/docker-note/docker-file/my-tomcat(master*) » docker run -d -p 8080:8080 4d2b3d59f957                                        harry@192</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">~/Learning/docker-note/docker-file/my-tomcat(master*) » docker ps                                                                      harry@192</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">e3b5a9979497        4d2b3d59f957        <span class="hljs-string">"/bin/sh -c '/usr/lo…"</span>   5 minutes ago       Up 5 minutes        0.0.0.0:8080-&gt;8080/tcp   sleepy_hopper</span><br><span class="line">------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>验证</li>
</ol>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">~/Learning/docker-note/docker-file/my-tomcat(master*) » docker <span class="hljs-built_in">exec</span> -it e3b5a9979497 /bin/bash                                         harry@192</span><br><span class="line"><span class="hljs-comment"># 验证：工作目录</span></span><br><span class="line"><span class="hljs-comment"># [root@e3b5a9979497 local] # pwd</span></span><br><span class="line">/usr/<span class="hljs-built_in">local</span></span><br><span class="line"><span class="hljs-comment"># 验证：vim</span></span><br><span class="line"><span class="hljs-comment"># [root@e3b5a9979497 local]# vim apache-tomcat-7.0.75/logs/catalina.out</span></span><br><span class="line">May 02, 2019 2:21:19 PM org.apache.catalina.startup.VersionLoggerListener <span class="hljs-built_in">log</span></span><br><span class="line">INFO: Server version:        Apache Tomcat/7.0.75</span><br><span class="line">May 02, 2019 2:21:19 PM org.apache.catalina.startup.VersionLoggerListener <span class="hljs-built_in">log</span></span><br><span class="line">INFO: Server built:          Jan 18 2017 20:54:42 UTC</span><br><span class="line">May 02, 2019 2:21:19 PM org.apache.catalina.startup.VersionLoggerListener <span class="hljs-built_in">log</span></span><br><span class="line">INFO: Server number:         7.0.75.0</span><br><span class="line">May 02, 2019 2:21:19 PM org.apache.catalina.startup.VersionLoggerListener <span class="hljs-built_in">log</span></span><br><span class="line">INFO: OS Name:               Linux</span><br><span class="line">May 02, 2019 2:21:19 PM org.apache.catalina.startup.VersionLoggerListener <span class="hljs-built_in">log</span></span><br><span class="line">INFO: OS Version:            4.9.125-linuxkit</span><br><span class="line">May 02, 2019 2:21:19 PM org.apache.catalina.startup.VersionLoggerListener <span class="hljs-built_in">log</span></span><br><span class="line">......</span><br><span class="line"><span class="hljs-comment"># 验证 jdk</span></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">~/Learning/docker-note/docker-file/my-tomcat(master*) » docker <span class="hljs-built_in">exec</span> -it e3b5a9979497 java -version                                     harry@192</span><br><span class="line">java version <span class="hljs-string">"1.8.0_121"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_121-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)</span><br><span class="line">------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><img src="http://img.yuzh.xyz/docker-note/1556807500784.jpg" alt></p>
<ol start="6">
<li>发布 Web 应用</li>
</ol>
<p>挂载数据卷，重新启动容器。</p>
<p>这样做的好处是不用进入容器查看日志，直接查看主机与容器共享的文件。发布 web 应用只需要在本地将 war 包放到共享文件夹，重启容器即可。</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># docker run -it -p 8888:8080 \</span></span><br><span class="line"><span class="hljs-comment"># -v ~/Learning/docker-note/docker-file/my-tomcat/webapp:/usr/local/apache-tomcat-7.0.75/webapps \</span></span><br><span class="line"><span class="hljs-comment"># -v ~/Learning/docker-note/docker-file/my-tomcat/logs:/usr/local/apache-tomcat-7.0.75/logs \</span></span><br><span class="line"><span class="hljs-comment"># 4d2b3d59f957</span></span><br></pre></td></tr></table></figure>
<p>新建 web 项目，将 web 包复制到容器的  webapp 目录下。容器 tomcat 即可。</p>
<p><img src="http://img.yuzh.xyz/docker-note/1556809298656.jpg" alt></p>
<h2 id="安装-MySql"><a href="#安装-MySql" class="headerlink" title="安装 MySql"></a>安装 MySql</h2><p><a href="https://hub.docker.com/_/mysql?tab=description" target="_blank" rel="noopener">Mysql DockerHub 官方文档</a></p>
<p>「总体步骤」</p>
<ol>
<li>docker search –filter=stars=30 mysql</li>
<li>docker pull mysql:latest</li>
<li><strong>docker run  -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</strong></li>
<li>进入到了 mysql 容器，通过命令行连接到 mysql 客户端：mysql -u root -p</li>
<li>…… 「输入密码」 ……</li>
<li>数据库操作（show databases; use mysql; show tables; select * from user; ……）</li>
</ol>
<p><strong>修改默认配置文件：</strong></p>
<p>Mysql 默认的配置文件在：<code>/etc/mysql/my.cnf</code>，我们可以在容器启动时以数据卷的方式挂载自己的配置文件到容器上：</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 假如 /my/custom  是我们的自定义配置文件</span></span><br><span class="line">docker run  -v /my/custom:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br></pre></td></tr></table></figure>
<p>这将会以 <code>/etc/mysql/my.cnf</code> 和 <code>/my/custom</code> 组合配置的方式新启动一个容器实例，后者优先级大于前者。</p>
<p><strong>不修改配置文件，使用命令参数配置 Mysql</strong></p>
<p>通过命令标志的形式传递给 mysqld，可以使我们更加灵活的配置 mysql 而不需要配置文件。如：修改所有表的编码方式只需在容器启动时添加以下参数</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure>
<p><strong>存储数据</strong></p>
<p>有两种方式存储应用程序在 Docker 容器运行中产生的数据。</p>
<ol>
<li>让 Docker 使用自己的数据卷管理方式存储将数据库文件写入到主机，这种方式最方便快捷，但是缺点是数据文件不方便找到和管理。</li>
<li>自己创建文件夹，使其挂载到 mysql 的数据文件。</li>
</ol>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /my/own/datadir:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br></pre></td></tr></table></figure>
<p><strong>备份数据</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="hljs-built_in">exec</span> some-mysql sh -c <span class="hljs-string">'exec mysqldump --all-databases -uroot -p"$MYSQL_ROOT_PASSWORD"'</span> &amp;gt; /some/path/on/your/host/all-databases.sql</span><br></pre></td></tr></table></figure>
<h2 id="安装-Redis"><a href="#安装-Redis" class="headerlink" title="安装 Redis"></a>安装 Redis</h2><p><a href="https://hub.docker.com/_/redis" target="_blank" rel="noopener">Redis DockerHub 官方文档</a></p>
<p><a href="http://doc.redisfans.com/index.html" target="_blank" rel="noopener">redis 命令手册</a></p>
<ol>
<li><p>docker pull redis</p>
</li>
<li><p>启动 redis 服务端：<strong>docker run -d -p 6379:6379 -v ~/Learning/docker-note/redis/data:/data redis redis-server –appendonly yes</strong><br>暴露端口，挂载本地文件到 redis 的持久化文件。避免容器删除 key 丢失。</p>
</li>
</ol>
<p>上面只是启动了服务端，容器运行后需要我们进入容器手动启动 redis 客户端进行测试。</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如何找到 redis 命令地址？可以通过查看 DockerHub 上 Redis 的 DockerFile文件得知在：`/usr/<span class="hljs-built_in">local</span>/bin/`。</span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/bin/ &amp;&amp; ./redis-cli</span><br><span class="line"><span class="hljs-comment"># exec redis commend ......</span></span><br></pre></td></tr></table></figure>
<p>「测试持久化」</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 在当前容器设置了三个 key</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="hljs-string">"k2"</span></span><br><span class="line">2) <span class="hljs-string">"k1"</span></span><br><span class="line">3) <span class="hljs-string">"k3"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 查看宿主机持久化文件：</span></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">~/Learning/docker-note/redis/data(master*) » <span class="hljs-built_in">pwd</span>                                                                                                                 harry@192</span><br><span class="line">/Users/harry/Learning/docker-note/redis/data</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">~/Learning/docker-note/redis/data(master*) » cat appendonly.aof                                                                                                  harry@192</span><br><span class="line">*2</span><br><span class="line"><span class="hljs-variable">$6</span></span><br><span class="line">SELECT</span><br><span class="line"><span class="hljs-variable">$1</span></span><br><span class="line">0</span><br><span class="line">*3</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p><em>证明是挂载成功的，然后删除容器，重新启动一个新容器，看数据是否同步过去了。</em></p>
<p><img src="http://img.yuzh.xyz/docker-note/1556880581267.jpg" alt></p>
<p>宿主机连接 docker 中的 redis：</p>
<p><img src="http://img.yuzh.xyz/docker-note/1556880819448.jpg" alt></p>
<p><strong>自定义配置文件</strong></p>
<ol>
<li><p>定制 DockerFile 的形式</p>
 <figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM redis</span><br><span class="line">COPY redis.conf /usr/<span class="hljs-built_in">local</span>/etc/redis/redis.conf</span><br><span class="line">CMD [ <span class="hljs-string">"redis-server"</span>, <span class="hljs-string">"/usr/local/etc/redis/redis.conf"</span> ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>命令行参数指定，灵活，推荐。</p>
 <figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /myredis/conf/redis.conf:/usr/<span class="hljs-built_in">local</span>/etc/redis/redis.conf redis redis-server /usr/<span class="hljs-built_in">local</span>/etc/redis/redis.conf</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="练习：Spring-Boot-单体应用容器化"><a href="#练习：Spring-Boot-单体应用容器化" class="headerlink" title="练习：Spring Boot 单体应用容器化"></a>练习：Spring Boot 单体应用容器化</h2><p>使用上面的 <code>test-dockerfile</code>  项目，构建一个镜像，通过容器运行并访问。</p>
<p>添加一个最简单的 Dockerfile</p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FROM tomcat:latest</span><br><span class="line">ENV WORK_PATH /usr/<span class="hljs-built_in">local</span>/tomcat</span><br><span class="line">ADD /target/<span class="hljs-built_in">test</span>-dockerfile-0.0.1-SNAPSHOT.jar <span class="hljs-variable">$&#123;WORK_PATH&#125;</span>/webapps/<span class="hljs-built_in">test</span>-dockerfile-0.0.1-SNAPSHOT.jar</span><br><span class="line">EXPOSE 8081</span><br><span class="line"><span class="hljs-comment"># PS：ENTRYPOINT ["","$&#123;WORK_PATH&#125;"] 这种方式是 exec 的形式执行，不会解析环境变量。除非使用 shell 的方式。</span></span><br><span class="line">ENTRYPOINT java -jar <span class="hljs-variable">$&#123;WORK_PATH&#125;</span>/webapps/<span class="hljs-built_in">test</span>-dockerfile-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>
<p>在项目根路径下执行：<code>docker build -f Dockerfile -t my-webapp:latest .</code></p>
<p>运行：<code>docker run -it -p 8081:8080 my-webapp:latest</code></p>
<p>访问：<a href="http://localhost:8081/api/hello-docker" target="_blank" rel="noopener">http://localhost:8081/api/hello-docker</a></p>
<p><img src="http://img.yuzh.xyz/docker-note/1556892499795.jpg" alt></p>
<p><em>PS：IDEA 2019 版集成了 Docker 工具，不过我还是使用命令吧😂。</em></p>
<p><img src="http://img.yuzh.xyz/docker-note/1556892760857.jpg" alt></p>
<h1 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h1><p>学会使用<a href="https://help.aliyun.com/product/60716.html?spm=a2c4g.11186623.6.540.10823864peBl6O" target="_blank" rel="noopener">「容器镜像服务」</a>，官方有详细文档说明，这里只记录主要步骤及问题。</p>
<p><strong>1）创建镜像仓库，指定代码源</strong></p>
<p><img src="http://img.yuzh.xyz/docker-note/1556888180808.jpg" alt="创建阿里云 code 项目"></p>
<p><img src="http://img.yuzh.xyz/docker-note/1556888080869.jpg" alt="创建镜像仓库"></p>
<p><strong>2) 登陆私有镜像仓库</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login --username=yuzh233 registry.cn-hangzhou.aliyuncs.com</span><br></pre></td></tr></table></figure>
<p><em>PS：修改密码入口：容器服务首页 -&gt; 访问凭证</em></p>
<p><strong>3） 上传镜像到私有仓库</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker login --username=yuzh233 registry.cn-hangzhou.aliyuncs.com</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/yuzh/test-dockerfile:[镜像版本号]</span></span><br><span class="line"><span class="hljs-comment"># ImageId 就是本地构建好需要上传到远程仓库的镜像ID</span></span><br><span class="line">docker tag fccdeb7abef7  registry.cn-hangzhou.aliyuncs.com/yuzh/<span class="hljs-built_in">test</span>-dockerfile:latest</span><br><span class="line"></span><br><span class="line">docker push registry.cn-hangzhou.aliyuncs.com/yuzh/<span class="hljs-built_in">test</span>-dockerfile:[镜像版本号]</span><br></pre></td></tr></table></figure>
<p><strong>4） 从私有仓库拉取镜像</strong></p>
<figure class="highlight sh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/yuzh/<span class="hljs-built_in">test</span>-dockerfile:[镜像版本号]</span><br></pre></td></tr></table></figure>
<h2 id="自动构建"><a href="#自动构建" class="headerlink" title="自动构建"></a>自动构建</h2>
        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/docker/">docker</a>, <a class="has-link-grey -link" href="/tags/微服务/">微服务</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2018/11/08/根据树的前序和后序表达式构造唯一树/">
                <span class="level-item">根据树的前序和后序表达式构造唯一树</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comments</h3>
        
<div id="valine-thread" class="content"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '#valine-thread' ,
        notify: true,
        verify: true,
        app_id: 'IaNb4n1EqHakKzNDh6jR1qYJ-gzGzoHsz',
        app_key: 'Hg7CxatEfuCfhqOsl7XYtEOv',
        placeholder: 'more than just code.'
    });
</script>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <figure class="image is-128x128 has-mb-6">
                            <img class="is-rounded" src="/images/tou.jpg" alt="harry.zh">
                        </figure>
                    
                    
                    <p class="is-size-4 is-block">
                        harry.zh
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        more than just code.
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Changsha, China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <p class="title has-text-weight-normal">
                        32
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <p class="title has-text-weight-normal">
                        4
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        28
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="http://github.com/yuzh233/" target="_blank">
                Follow</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="http://github.com/yuzh233/">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Facebook" href="/">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Twitter" href="/">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Dribbble" href="/">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
<div class="card widget" id="toc">
<!-- <div class="card widget column-left is-sticky" id="toc"> -->
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Catalogue
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#配置阿里云镜像加速">
        <span class="has-mr-6">1</span>
        <span>配置阿里云镜像加速</span>
        </a></li><li>
        <a class="is-flex" href="#学会使用帮助命令">
        <span class="has-mr-6">2</span>
        <span>学会使用帮助命令</span>
        </a></li><li>
        <a class="is-flex" href="#镜像">
        <span class="has-mr-6">3</span>
        <span>镜像</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#查看本地镜像">
        <span class="has-mr-6">3.1</span>
        <span>查看本地镜像</span>
        </a></li><li>
        <a class="is-flex" href="#从-Docker-Hub-查询镜像">
        <span class="has-mr-6">3.2</span>
        <span>从 Docker Hub 查询镜像</span>
        </a></li><li>
        <a class="is-flex" href="#拉取镜像">
        <span class="has-mr-6">3.3</span>
        <span>拉取镜像</span>
        </a></li><li>
        <a class="is-flex" href="#删除本地镜像">
        <span class="has-mr-6">3.4</span>
        <span>删除本地镜像</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#容器">
        <span class="has-mr-6">4</span>
        <span>容器</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#新建并启动容器">
        <span class="has-mr-6">4.1</span>
        <span>新建并启动容器</span>
        </a></li><li>
        <a class="is-flex" href="#查看当前所有正在运行的容器">
        <span class="has-mr-6">4.2</span>
        <span>查看当前所有正在运行的容器</span>
        </a></li><li>
        <a class="is-flex" href="#退出容器">
        <span class="has-mr-6">4.3</span>
        <span>退出容器</span>
        </a></li><li>
        <a class="is-flex" href="#启动容器">
        <span class="has-mr-6">4.4</span>
        <span>启动容器</span>
        </a></li><li>
        <a class="is-flex" href="#重启容器">
        <span class="has-mr-6">4.5</span>
        <span>重启容器</span>
        </a></li><li>
        <a class="is-flex" href="#停止容器">
        <span class="has-mr-6">4.6</span>
        <span>停止容器</span>
        </a></li><li>
        <a class="is-flex" href="#强制停止容器">
        <span class="has-mr-6">4.7</span>
        <span>强制停止容器</span>
        </a></li><li>
        <a class="is-flex" href="#删除已停止的容器">
        <span class="has-mr-6">4.8</span>
        <span>删除已停止的容器</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#容器重要知识点">
        <span class="has-mr-6">5</span>
        <span>容器重要知识点</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#启动守护式容器">
        <span class="has-mr-6">5.1</span>
        <span>启动守护式容器</span>
        </a></li><li>
        <a class="is-flex" href="#查看容器日志">
        <span class="has-mr-6">5.2</span>
        <span>查看容器日志</span>
        </a></li><li>
        <a class="is-flex" href="#查看容器内运行的进程">
        <span class="has-mr-6">5.3</span>
        <span>查看容器内运行的进程</span>
        </a></li><li>
        <a class="is-flex" href="#查看容器内部细节">
        <span class="has-mr-6">5.4</span>
        <span>查看容器内部细节</span>
        </a></li><li>
        <a class="is-flex" href="#进入正在运行的容器并以命令行交互">
        <span class="has-mr-6">5.5</span>
        <span>进入正在运行的容器并以命令行交互</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#docker-attach-容器ID">
        <span class="has-mr-6">5.5.1</span>
        <span>docker attach 容器ID</span>
        </a></li><li>
        <a class="is-flex" href="#docker-exec-it-容器ID-bashShell">
        <span class="has-mr-6">5.5.2</span>
        <span>docker exec -it 容器ID bashShell</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#从容器内拷贝文件到主机上">
        <span class="has-mr-6">5.6</span>
        <span>从容器内拷贝文件到主机上</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#镜像原理">
        <span class="has-mr-6">6</span>
        <span>镜像原理</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#是什么">
        <span class="has-mr-6">6.1</span>
        <span>是什么</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#UnionFS（联合文件系统）">
        <span class="has-mr-6">6.1.1</span>
        <span>UnionFS（联合文件系统）</span>
        </a></li><li>
        <a class="is-flex" href="#Docker-镜像加载原理">
        <span class="has-mr-6">6.1.2</span>
        <span>Docker 镜像加载原理</span>
        </a></li><li>
        <a class="is-flex" href="#为什么-Docker-镜像要采用分层的结构">
        <span class="has-mr-6">6.1.3</span>
        <span>为什么 Docker 镜像要采用分层的结构</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#特点">
        <span class="has-mr-6">6.2</span>
        <span>特点</span>
        </a></li><li>
        <a class="is-flex" href="#镜像的-commit-操作">
        <span class="has-mr-6">6.3</span>
        <span>镜像的 commit 操作</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#容器数据卷">
        <span class="has-mr-6">7</span>
        <span>容器数据卷</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#作用">
        <span class="has-mr-6">7.1</span>
        <span>作用</span>
        </a></li><li>
        <a class="is-flex" href="#概念">
        <span class="has-mr-6">7.2</span>
        <span>概念</span>
        </a></li><li>
        <a class="is-flex" href="#使用一：命令方式挂载数据卷">
        <span class="has-mr-6">7.3</span>
        <span>使用一：命令方式挂载数据卷</span>
        </a></li><li>
        <a class="is-flex" href="#使用二：-DockerFile-挂载数据卷">
        <span class="has-mr-6">7.4</span>
        <span>使用二： DockerFile 挂载数据卷</span>
        </a></li><li>
        <a class="is-flex" href="#使用三：使用数据卷容器实现数据共享">
        <span class="has-mr-6">7.5</span>
        <span>使用三：使用数据卷容器实现数据共享</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#DockerFile">
        <span class="has-mr-6">8</span>
        <span>DockerFile</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#DockerFile-指令">
        <span class="has-mr-6">8.1</span>
        <span>DockerFile 指令</span>
        </a></li><li>
        <a class="is-flex" href="#案例">
        <span class="has-mr-6">8.2</span>
        <span>案例</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Base镜像（scratch）">
        <span class="has-mr-6">8.2.1</span>
        <span>Base镜像（scratch）</span>
        </a></li><li>
        <a class="is-flex" href="#自定义镜像-my-centos">
        <span class="has-mr-6">8.2.2</span>
        <span>自定义镜像 my-centos</span>
        </a></li><li>
        <a class="is-flex" href="#CMD-ENTERPOINT-镜像案例">
        <span class="has-mr-6">8.2.3</span>
        <span>CMD/ENTERPOINT 镜像案例</span>
        </a></li><li>
        <a class="is-flex" href="#自定义镜像-Tomcat">
        <span class="has-mr-6">8.2.4</span>
        <span>自定义镜像 Tomcat</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#安装-MySql">
        <span class="has-mr-6">8.3</span>
        <span>安装 MySql</span>
        </a></li><li>
        <a class="is-flex" href="#安装-Redis">
        <span class="has-mr-6">8.4</span>
        <span>安装 Redis</span>
        </a></li><li>
        <a class="is-flex" href="#练习：Spring-Boot-单体应用容器化">
        <span class="has-mr-6">8.5</span>
        <span>练习：Spring Boot 单体应用容器化</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#仓库">
        <span class="has-mr-6">9</span>
        <span>仓库</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#自动构建">
        <span class="has-mr-6">9.1</span>
        <span>自动构建</span>
        </a></li></ul></li></ul>
        </div>
    </div>
</div>

    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/bug-fix/">
            <span class="level-start">
                <span class="level-item">bug-fix</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/docker/">
            <span class="level-start">
                <span class="level-item">docker</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/interview/">
            <span class="level-start">
                <span class="level-item">interview</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">9</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/spring-boot/">
            <span class="level-start">
                <span class="level-item">spring-boot</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/aliyun/" style="font-size: 10px;">aliyun</a> <a href="/tags/aop/" style="font-size: 12.5px;">aop</a> <a href="/tags/cokie/" style="font-size: 10px;">cokie</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/dubbo/" style="font-size: 10px;">dubbo</a> <a href="/tags/freeMarker/" style="font-size: 10px;">freeMarker</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hexo/" style="font-size: 12.5px;">hexo</a> <a href="/tags/idea/" style="font-size: 10px;">idea</a> <a href="/tags/jms/" style="font-size: 10px;">jms</a> <a href="/tags/jsonp/" style="font-size: 10px;">jsonp</a> <a href="/tags/linux/" style="font-size: 12.5px;">linux</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/nio/" style="font-size: 10px;">nio</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/solr/" style="font-size: 10px;">solr</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/springboot/" style="font-size: 10px;">springboot</a> <a href="/tags/sso/" style="font-size: 10px;">sso</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/分布式/" style="font-size: 20px;">分布式</a> <a href="/tags/微服务/" style="font-size: 10px;">微服务</a> <a href="/tags/数据结构/" style="font-size: 17.5px;">数据结构</a> <a href="/tags/无关代码/" style="font-size: 10px;">无关代码</a> <a href="/tags/算法/" style="font-size: 17.5px;">算法</a> <a href="/tags/线程/" style="font-size: 10px;">线程</a> <a href="/tags/集群/" style="font-size: 10px;">集群</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/05/11/Docker补救指南/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="http://img.yuzh.xyz/docker-note/wallhaven-263173.jpg" alt="Docker 补救指南">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-05-10T16:00:00.000Z">2019-05-11</time></div>
                    <a href="/2019/05/11/Docker补救指南/" class="has-link-black-ter is-size-6">Docker 补救指南</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/docker/">docker</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/08/根据树的前序和后序表达式构造唯一树/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/img/sujin/wallhaven-282224.jpg" alt="根据树的前序和后序表达式构造唯一树">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-08T12:53:00.000Z">2018-11-08</time></div>
                    <a href="/2018/11/08/根据树的前序和后序表达式构造唯一树/" class="has-link-black-ter is-size-6">根据树的前序和后序表达式构造唯一树</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/interview/">interview</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/08/树的三种遍历方式/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/img/sujin/wallhaven-204334.jpg" alt="树的三种遍历方式">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-08T03:46:00.000Z">2018-11-08</time></div>
                    <a href="/2018/11/08/树的三种遍历方式/" class="has-link-black-ter is-size-6">树的三种遍历方式</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/interview/">interview</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/06/源码角度分析 CharacterEncodingFilter 解决 Post 请求中文乱码问题/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/img/sujin/wallhaven-252102.jpg" alt="源码角度分析 CharacterEncodingFilter 解决 Post 请求中文乱码问题">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-06T07:53:00.000Z">2018-11-06</time></div>
                    <a href="/2018/11/06/源码角度分析 CharacterEncodingFilter 解决 Post 请求中文乱码问题/" class="has-link-black-ter is-size-6">源码角度分析 CharacterEncodingFilter 解决 Post 请求中文乱码问题</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/interview/">interview</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/04/数据库常用事务传播行为与隔离级别/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/img/sujin/jay-wennington-2250-unsplash.jpg" alt="数据库常用事务传播行为与隔离级别">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T16:26:00.000Z">2018-11-04</time></div>
                    <a href="/2018/11/04/数据库常用事务传播行为与隔离级别/" class="has-link-black-ter is-size-6">数据库常用事务传播行为与隔离级别</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/interview/">interview</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">May 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">October 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">June 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/aliyun/">
                        <span class="tag">aliyun</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/aop/">
                        <span class="tag">aop</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/cokie/">
                        <span class="tag">cokie</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/dubbo/">
                        <span class="tag">dubbo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/freeMarker/">
                        <span class="tag">freeMarker</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hexo/">
                        <span class="tag">hexo</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/idea/">
                        <span class="tag">idea</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jms/">
                        <span class="tag">jms</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jsonp/">
                        <span class="tag">jsonp</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux/">
                        <span class="tag">linux</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/maven/">
                        <span class="tag">maven</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/nginx/">
                        <span class="tag">nginx</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/nio/">
                        <span class="tag">nio</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/solr/">
                        <span class="tag">solr</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/springboot/">
                        <span class="tag">springboot</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/sso/">
                        <span class="tag">sso</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/tomcat/">
                        <span class="tag">tomcat</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分布式/">
                        <span class="tag">分布式</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/微服务/">
                        <span class="tag">微服务</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/无关代码/">
                        <span class="tag">无关代码</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/算法/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线程/">
                        <span class="tag">线程</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/集群/">
                        <span class="tag">集群</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/05/11/Docker补救指南/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="http://img.yuzh.xyz/docker-note/wallhaven-263173.jpg" alt="Docker 补救指南">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-05-10T16:00:00.000Z">2019-05-11</time></div>
                    <a href="/2019/05/11/Docker补救指南/" class="has-link-black-ter is-size-6">Docker 补救指南</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/docker/">docker</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/08/根据树的前序和后序表达式构造唯一树/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/img/sujin/wallhaven-282224.jpg" alt="根据树的前序和后序表达式构造唯一树">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-08T12:53:00.000Z">2018-11-08</time></div>
                    <a href="/2018/11/08/根据树的前序和后序表达式构造唯一树/" class="has-link-black-ter is-size-6">根据树的前序和后序表达式构造唯一树</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/interview/">interview</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/08/树的三种遍历方式/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/img/sujin/wallhaven-204334.jpg" alt="树的三种遍历方式">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-08T03:46:00.000Z">2018-11-08</time></div>
                    <a href="/2018/11/08/树的三种遍历方式/" class="has-link-black-ter is-size-6">树的三种遍历方式</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/interview/">interview</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/06/源码角度分析 CharacterEncodingFilter 解决 Post 请求中文乱码问题/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/img/sujin/wallhaven-252102.jpg" alt="源码角度分析 CharacterEncodingFilter 解决 Post 请求中文乱码问题">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-06T07:53:00.000Z">2018-11-06</time></div>
                    <a href="/2018/11/06/源码角度分析 CharacterEncodingFilter 解决 Post 请求中文乱码问题/" class="has-link-black-ter is-size-6">源码角度分析 CharacterEncodingFilter 解决 Post 请求中文乱码问题</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/interview/">interview</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/04/数据库常用事务传播行为与隔离级别/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/img/sujin/jay-wennington-2250-unsplash.jpg" alt="数据库常用事务传播行为与隔离级别">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T16:26:00.000Z">2018-11-04</time></div>
                    <a href="/2018/11/04/数据库常用事务传播行为与隔离级别/" class="has-link-black-ter is-size-6">数据库常用事务传播行为与隔离级别</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/interview/">interview</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">May 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">October 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">June 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/aliyun/">
                        <span class="tag">aliyun</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/aop/">
                        <span class="tag">aop</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/cokie/">
                        <span class="tag">cokie</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/dubbo/">
                        <span class="tag">dubbo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/freeMarker/">
                        <span class="tag">freeMarker</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hexo/">
                        <span class="tag">hexo</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/idea/">
                        <span class="tag">idea</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jms/">
                        <span class="tag">jms</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jsonp/">
                        <span class="tag">jsonp</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux/">
                        <span class="tag">linux</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/maven/">
                        <span class="tag">maven</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/nginx/">
                        <span class="tag">nginx</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/nio/">
                        <span class="tag">nio</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/solr/">
                        <span class="tag">solr</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/springboot/">
                        <span class="tag">springboot</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/sso/">
                        <span class="tag">sso</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/tomcat/">
                        <span class="tag">tomcat</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分布式/">
                        <span class="tag">分布式</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/微服务/">
                        <span class="tag">微服务</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/无关代码/">
                        <span class="tag">无关代码</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/算法/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线程/">
                        <span class="tag">线程</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/集群/">
                        <span class="tag">集群</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/star.png" alt="Docker 补救指南" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 张 瑜&nbsp;
                Powered by Hexo & Icarus<br>
                <a href="http://www.miitbeian.gov.cn/" target="_blank">湘ICP备 18020713号</a>
                </p>
                
                <p></p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/yuzh233">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>